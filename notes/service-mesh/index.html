<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Service Mesh | @abiydv</title>
<meta name=keywords content><meta name=description content="What is a service mesh, and where to use one?"><meta name=author content><link rel=canonical href=https://abiydv.github.io/notes/service-mesh/><link crossorigin=anonymous href=/assets/css/stylesheet.c5edd088d0c984c192170cfbab7d2de030010ee0b7d771bd6bca049dd2332874.css integrity="sha256-xe3QiNDJhMGSFwz7q30t4DABDuC313G9a8oEndIzKHQ=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://abiydv.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://abiydv.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://abiydv.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://abiydv.github.io/apple-touch-icon.png><link rel=mask-icon href=https://abiydv.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://abiydv.github.io/notes/service-mesh/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="Service Mesh"><meta property="og:description" content="What is a service mesh, and where to use one?"><meta property="og:type" content="article"><meta property="og:url" content="https://abiydv.github.io/notes/service-mesh/"><meta property="article:section" content="notes"><meta property="article:published_time" content="2024-08-29T00:00:00+00:00"><meta property="article:modified_time" content="2025-04-04T12:48:24+01:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Service Mesh"><meta name=twitter:description content="What is a service mesh, and where to use one?"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Notes","item":"https://abiydv.github.io/notes/"},{"@type":"ListItem","position":2,"name":"Service Mesh","item":"https://abiydv.github.io/notes/service-mesh/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Service Mesh","name":"Service Mesh","description":"What is a service mesh, and where to use one?","keywords":[],"articleBody":"What is a service mesh? Examples Istio Uses Envoy\nSidecar or Ambient mode\nhttps://istio.io/latest/docs/concepts/traffic-management/\nComponents Virtual Service Destination Rule Gateway Service Entry (can register external services) How does Traffic flow through Istio? Some important components to be aware of, in order\nIngress Gateway Gateway Virtual Service Service Entry Deployment App pod proxy container App pod app container Istio Ingress Gateway (configures the cloud load balancer)\napiVersion: v1 kind: Service metadata: annotations: meta.helm.sh/release-name: istio-ingressgateway meta.helm.sh/release-namespace: istio-system service.beta.kubernetes.io/aws-load-balancer-backend-protocol: http service.beta.kubernetes.io/aws-load-balancer-internal: \"true\" service.beta.kubernetes.io/aws-load-balancer-name: nlb-istio service.beta.kubernetes.io/aws-load-balancer-ssl-cert: .. service.beta.kubernetes.io/aws-load-balancer-ssl-ports: https service.beta.kubernetes.io/aws-load-balancer-type: nlb .. finalizers: - service.kubernetes.io/load-balancer-cleanup labels: app: istio-ingressgateway app.kubernetes.io/managed-by: Helm app.kubernetes.io/name: istio-ingressgateway app.kubernetes.io/version: 1.20.0 helm.sh/chart: gateway-1.20.0 istio: ingressgateway name: istio-ingressgateway namespace: istio-system .. spec: .. selector: app: istio-ingressgateway istio: ingressgateway .. type: LoadBalancer Istio Gateway\napiVersion: networking.istio.io/v1beta1 kind: Gateway metadata: annotations: name: app-gateway namespace: app-namespace spec: selector: istio: ingressgateway # maps to istio ingress gateway defined above servers: - hosts: - app-name.example.com port: name: http number: 80 protocol: HTTP tls: httpsRedirect: true - hosts: - app-name.example.com port: name: https number: 443 protocol: HTTPS # can be http tls: credentialName: app-name-cert # do i need this? mode: SIMPLE Istio Virtual Service\napiVersion: networking.istio.io/v1beta1 kind: VirtualService metadata: name: app-name namespace: app-namespace spec: gateways: - app-gateway # refers to the gateway created above hosts: - app-name.example.com http: - route: - destination: host: app-name port: number: 80 Logging Deploy this to enable access logging on a specific app. Ref\napiVersion: telemetry.istio.io/v1alpha1 kind: Telemetry metadata: name: app-access-logs namespace: app-namespace spec: selector: matchLabels: service.istio.io/canonical-name: app-name accessLogging: - providers: - name: envoy Log response body for a particular app using lua http filters.\napiVersion: networking.istio.io/v1alpha3 kind: EnvoyFilter metadata: name: app-resp-log namespace: app-namespace spec: workloadSelector: labels: service.istio.io/canonical-name: app-name configPatches: - applyTo: HTTP_FILTER match: context: ANY listener: filterChain: filter: name: envoy.filters.network.http_connection_manager patch: operation: INSERT_BEFORE value: name: envoy.lua typed_config: \"@type\": \"type.googleapis.com/envoy.extensions.filters.http.lua.v3.Lua\" inlineCode: | function envoy_on_response(response_handle) local body = response_handle:body() local jsonString = tostring(body:getBytes(0, body:length())) response_handle:logErr(\"Status: \"..response_handle:headers():get(\":status\")) response_handle:logErr(\"BodyJSONString: \"..jsonString) end Modify log level on running containers. Ref\nkubectl -n namespace exec -i -t pod/podname -c istio-proxy -- /bin/sh $ curl -X POST http://localhost:15000/logging?level=debug ","wordCount":"338","inLanguage":"en","datePublished":"2024-08-29T00:00:00Z","dateModified":"2025-04-04T12:48:24+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://abiydv.github.io/notes/service-mesh/"},"publisher":{"@type":"Organization","name":"@abiydv","logo":{"@type":"ImageObject","url":"https://abiydv.github.io/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://abiydv.github.io/ accesskey=h title="@abiydv (Alt + H)">@abiydv</a><div class=logo-switches></div></div><ul id=menu><li><a href=https://abiydv.github.io/ title=Home><span>Home</span></a></li><li><a href=https://abiydv.github.io/about/ title=About><span>About</span></a></li><li><a href=https://abiydv.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://abiydv.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://abiydv.github.io/notes/ title=Notes><span>Notes</span></a></li><li><a href=https://abiydv.github.io/search title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://abiydv.github.io/>Home</a>&nbsp;Â»&nbsp;<a href=https://abiydv.github.io/notes/>Notes</a></div><h1 class=post-title>Service Mesh<sup>&nbsp;<span class="entry-stage sandbox">&nbsp;sandbox&nbsp;</span></sup></h1><div class=post-description>What is a service mesh, and where to use one?</div><div class=post-meta><s>29.8.24</s>&nbsp;4.4.25 / Notes / 2 min</div></header><div class=post-content><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#what-is-a-service-mesh aria-label="What is a service mesh?">What is a service mesh?</a></li><li><a href=#examples aria-label=Examples>Examples</a><ul><li><a href=#istio aria-label=Istio>Istio</a><ul><li><a href=#components aria-label=Components>Components</a></li><li><a href=#how-does-traffic-flow-through-istio aria-label="How does Traffic flow through Istio?">How does Traffic flow through Istio?</a></li><li><a href=#logging aria-label=Logging>Logging</a></li></ul></li></ul></li></ul></div></details></div></div><div class=post-content><h2 id=what-is-a-service-mesh>What is a service mesh?<a hidden class=anchor aria-hidden=true href=#what-is-a-service-mesh>#</a></h2><h2 id=examples>Examples<a hidden class=anchor aria-hidden=true href=#examples>#</a></h2><h3 id=istio>Istio<a hidden class=anchor aria-hidden=true href=#istio>#</a></h3><p>Uses Envoy<br>Sidecar or Ambient mode</p><p><a href=https://istio.io/latest/docs/concepts/traffic-management/>https://istio.io/latest/docs/concepts/traffic-management/</a></p><h4 id=components>Components<a hidden class=anchor aria-hidden=true href=#components>#</a></h4><ul><li>Virtual Service</li><li>Destination Rule</li><li>Gateway</li><li>Service Entry (can register external services)</li></ul><h4 id=how-does-traffic-flow-through-istio>How does Traffic flow through Istio?<a hidden class=anchor aria-hidden=true href=#how-does-traffic-flow-through-istio>#</a></h4><p>Some important components to be aware of, in order</p><ul><li>Ingress Gateway</li><li>Gateway</li><li>Virtual Service</li><li>Service Entry</li><li>Deployment</li><li>App pod proxy container</li><li>App pod app container</li></ul><p><strong>Istio Ingress Gateway</strong> (configures the cloud load balancer)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>annotations</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>meta.helm.sh/release-name</span>: <span style=color:#ae81ff>istio-ingressgateway</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>meta.helm.sh/release-namespace</span>: <span style=color:#ae81ff>istio-system</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>service.beta.kubernetes.io/aws-load-balancer-backend-protocol</span>: <span style=color:#ae81ff>http</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>service.beta.kubernetes.io/aws-load-balancer-internal</span>: <span style=color:#e6db74>&#34;true&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>service.beta.kubernetes.io/aws-load-balancer-name</span>: <span style=color:#ae81ff>nlb-istio</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>service.beta.kubernetes.io/aws-load-balancer-ssl-cert</span>: <span style=color:#ae81ff>..</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>service.beta.kubernetes.io/aws-load-balancer-ssl-ports</span>: <span style=color:#ae81ff>https</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>service.beta.kubernetes.io/aws-load-balancer-type</span>: <span style=color:#ae81ff>nlb</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>..</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>finalizers</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>service.kubernetes.io/load-balancer-cleanup</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>istio-ingressgateway</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>app.kubernetes.io/managed-by</span>: <span style=color:#ae81ff>Helm</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>app.kubernetes.io/name</span>: <span style=color:#ae81ff>istio-ingressgateway</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>app.kubernetes.io/version</span>: <span style=color:#ae81ff>1.20.0</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>helm.sh/chart</span>: <span style=color:#ae81ff>gateway-1.20.0</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>istio</span>: <span style=color:#ae81ff>ingressgateway</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>istio-ingressgateway</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>istio-system</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>..</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>..</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>istio-ingressgateway</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>istio</span>: <span style=color:#ae81ff>ingressgateway</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>..</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>LoadBalancer</span>
</span></span></code></pre></div><p><strong>Istio Gateway</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>networking.istio.io/v1beta1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Gateway</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>annotations</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>app-gateway</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>app-namespace</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>istio</span>: <span style=color:#ae81ff>ingressgateway</span> <span style=color:#75715e># maps to istio ingress gateway defined above</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>servers</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>hosts</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>app-name.example.com</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>port</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>http</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>number</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>protocol</span>: <span style=color:#ae81ff>HTTP</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>tls</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>httpsRedirect</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>hosts</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>app-name.example.com</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>port</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>https</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>number</span>: <span style=color:#ae81ff>443</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>protocol</span>: <span style=color:#ae81ff>HTTPS</span> <span style=color:#75715e># can be http</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>tls</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>credentialName</span>: <span style=color:#ae81ff>app-name-cert</span> <span style=color:#75715e># do i need this?</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>mode</span>: <span style=color:#ae81ff>SIMPLE</span>
</span></span></code></pre></div><p><strong>Istio Virtual Service</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>networking.istio.io/v1beta1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>VirtualService</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>app-name</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>app-namespace</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>gateways</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>app-gateway</span> <span style=color:#75715e># refers to the gateway created above</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>hosts</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>app-name.example.com</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>http</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>route</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>destination</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>host</span>: <span style=color:#ae81ff>app-name</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>port</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>number</span>: <span style=color:#ae81ff>80</span>
</span></span></code></pre></div><h4 id=logging>Logging<a hidden class=anchor aria-hidden=true href=#logging>#</a></h4><p>Deploy this to enable access logging on a specific app. <a href=https://istio.io/latest/docs/reference/config/telemetry/#Telemetry>Ref</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>telemetry.istio.io/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Telemetry</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>app-access-logs</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>app-namespace</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>service.istio.io/canonical-name</span>: <span style=color:#ae81ff>app-name</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>accessLogging</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>providers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>envoy</span>
</span></span></code></pre></div><p>Log response body for a particular app using <a href=https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_filters/lua_filter>lua http filters</a>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>networking.istio.io/v1alpha3</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>EnvoyFilter</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>app-resp-log</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>app-namespace</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>workloadSelector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>service.istio.io/canonical-name</span>: <span style=color:#ae81ff>app-name</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>configPatches</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>applyTo</span>: <span style=color:#ae81ff>HTTP_FILTER</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>match</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>context</span>: <span style=color:#ae81ff>ANY</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>listener</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>filterChain</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>filter</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>name</span>: <span style=color:#ae81ff>envoy.filters.network.http_connection_manager</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>patch</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>operation</span>: <span style=color:#ae81ff>INSERT_BEFORE</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>value</span>: 
</span></span><span style=display:flex><span>       <span style=color:#f92672>name</span>: <span style=color:#ae81ff>envoy.lua</span>
</span></span><span style=display:flex><span>       <span style=color:#f92672>typed_config</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;@type&#34;: </span><span style=color:#e6db74>&#34;type.googleapis.com/envoy.extensions.filters.http.lua.v3.Lua&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>inlineCode</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            function envoy_on_response(response_handle) 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                local body = response_handle:body()
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                local jsonString = tostring(body:getBytes(0, body:length()))
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                response_handle:logErr(&#34;Status: &#34;..response_handle:headers():get(&#34;:status&#34;))
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                response_handle:logErr(&#34;BodyJSONString: &#34;..jsonString)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            end</span>            
</span></span></code></pre></div><p>Modify log level on running containers. <a href=https://github.com/istio/istio/issues/8076#issuecomment-467916427>Ref</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl -n namespace exec -i -t pod/podname -c istio-proxy -- /bin/sh
</span></span><span style=display:flex><span>$ curl -X POST http://localhost:15000/logging?level<span style=color:#f92672>=</span>debug
</span></span></code></pre></div></div><footer class=post-footer><hr><div class=align-center><div class=slimlist-entry><h2>Topics</h2></div><ul class=post-tags><div class=slimlist-entry><li class=post-tags><a href=https://abiydv.github.io/topics/stage-sandbox/>stage/sandbox</a></li><li class=post-tags><a href=https://abiydv.github.io/topics/network/>network</a></li></div></ul></div></footer><script src=https://utteranc.es/client.js repo=abiydv/abiydv.github.io issue-term=title label=Comment theme=github-light crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2019-2025 <a href=https://abiydv.github.io/>@abiydv</a> / </span><span>Published 4.4.25 /
</span><span>Thanks <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a>, <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script></body></html>