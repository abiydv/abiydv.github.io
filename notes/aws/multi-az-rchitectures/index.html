<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Multi-AZ Architectures | @abiydv</title>
<meta name=keywords content><meta name=description content="Questions What is the scope? AZ, Regional, Global
When or why will you choose both CloudFront AND Load balancer?
What is an AZ? AZ or availability zone is an independent data center within a specific geographic region. An AWS Region is a collection of multiple availability zones. Regarded as a fault boundary. Data transfer across AZ is not free. Cross AZ traffic should be controlled for cost optimization and performance efficiency."><meta name=author content><link rel=canonical href=https://abiydv.github.io/notes/aws/multi-az-rchitectures/><link crossorigin=anonymous href=/assets/css/stylesheet.c5edd088d0c984c192170cfbab7d2de030010ee0b7d771bd6bca049dd2332874.css integrity="sha256-xe3QiNDJhMGSFwz7q30t4DABDuC313G9a8oEndIzKHQ=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://abiydv.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://abiydv.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://abiydv.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://abiydv.github.io/apple-touch-icon.png><link rel=mask-icon href=https://abiydv.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://abiydv.github.io/notes/aws/multi-az-rchitectures/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="Multi-AZ Architectures"><meta property="og:description" content="Questions What is the scope? AZ, Regional, Global
When or why will you choose both CloudFront AND Load balancer?
What is an AZ? AZ or availability zone is an independent data center within a specific geographic region. An AWS Region is a collection of multiple availability zones. Regarded as a fault boundary. Data transfer across AZ is not free. Cross AZ traffic should be controlled for cost optimization and performance efficiency."><meta property="og:type" content="article"><meta property="og:url" content="https://abiydv.github.io/notes/aws/multi-az-rchitectures/"><meta property="article:section" content="notes"><meta property="article:published_time" content="2024-02-15T00:00:00+00:00"><meta property="article:modified_time" content="2025-04-04T12:48:24+01:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Multi-AZ Architectures"><meta name=twitter:description content="Questions What is the scope? AZ, Regional, Global
When or why will you choose both CloudFront AND Load balancer?
What is an AZ? AZ or availability zone is an independent data center within a specific geographic region. An AWS Region is a collection of multiple availability zones. Regarded as a fault boundary. Data transfer across AZ is not free. Cross AZ traffic should be controlled for cost optimization and performance efficiency."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Notes","item":"https://abiydv.github.io/notes/"},{"@type":"ListItem","position":2,"name":"AWS","item":"https://abiydv.github.io/notes/aws/"},{"@type":"ListItem","position":3,"name":"Multi-AZ Architectures","item":"https://abiydv.github.io/notes/aws/multi-az-rchitectures/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Multi-AZ Architectures","name":"Multi-AZ Architectures","description":"Questions What is the scope? AZ, Regional, Global\nWhen or why will you choose both CloudFront AND Load balancer?\nWhat is an AZ? AZ or availability zone is an independent data center within a specific geographic region. An AWS Region is a collection of multiple availability zones. Regarded as a fault boundary. Data transfer across AZ is not free. Cross AZ traffic should be controlled for cost optimization and performance efficiency.","keywords":[],"articleBody":"Questions What is the scope? AZ, Regional, Global\nWhen or why will you choose both CloudFront AND Load balancer?\nWhat is an AZ? AZ or availability zone is an independent data center within a specific geographic region. An AWS Region is a collection of multiple availability zones. Regarded as a fault boundary. Data transfer across AZ is not free. Cross AZ traffic should be controlled for cost optimization and performance efficiency. Why use multiple AZ? Improves reliability since failures in one AZ do not cause full outage of the workload. Improves performance by reducing latency. Helpful in disaster recovery? Is Route53 AZ aware? In the example with app servers trying to reach the AD domain controller, how does the name resolution help keep the traffic in the same AZ?\nCreate AZ specific DNS entries using network interfaces in the same AZ. For ex - NLB provides a static IP for network interface in each AZ. Use this to create endpoints such as euw-az1.myservice.com, instead of letting clients use myservice.com.\nChallenges Random AZ name to AZ id mapping AWS maps AZ names to different AZ ids in each account, to distribute load more evenly across all it’s data centers. AZ name format is eu-west-1a, where as AZ id format is euw1-az1. AZ name to AZ id mapping can differ between accounts. AZ id is the same everywhere. Example from an AWS Account (eu-west-1 region) -\u003e EC2 Dashboard AZ name AZ ID eu-west-1a euw1-az3 eu-west-1b euw1-az1 eu-west-1c euw1-az2 No visibility to others’ AZ choices Multi-account setups usually have multiple VPC peering and/or transit gateway attachments, often with differing AZ choices.\nOne team may not be aware of the other teams’ AZ choices. This can cause traffic to cross the AZ boundary when workloads deployed in different accounts/VPCs need to interact.\nGuidelines Due to the above mentioned challenges of multi-AZ architectures, it is important to follow some guidelines when designing.\nManage AZ assignments centrally Just like managing VPC CIDR ranges centrally with IPAM, manage the preferred AZ centrally as well.\nExample, when using VPC with CIDR range of /16, it can be divided further into /20 blocks. The first two /20 blocks can then be used in the first two AZs in all accounts. This greatly simplifies the routing table of the Transit Gateway in the shared network account.\nVPC range AZ 1 range AZ 2 range 10.1.0.0/16 10.1.0.0/20 10.1.16.0/20 AZ aware shared networking AWS Transit Gateway is AZ aware (except in appliance mode) and keeps the traffic in the same AZ as source, until it reaches the destination or is routed to a different AZ. Refer examples.\nWhen attaching a TGW to a VPC, use the same AZ that subnets in the VPC use.\nDisable cross-zone load balancing Load Balancers route traffic across AZ, by default (cross-zone load balancing = enabled). Consider disabling cross-zone load balancing when using cross-account load balancer. Be aware of the following trade-offs\nCapacity planning in each AZ to ensure adequate redundancy No support for stickiness AWS Network Load Balancer does not route traffic across AZ, by default (cross-zone load balancing = disabled).\nUse AZ local resources Use local resources within the AZ, if possible.\nExample, if there are AD controllers an app needs to reach, consider configuring the app instances in each AZ with the address of the AD controller of that specific AZ. This would ensure there is no risk of traffic crossing the AZ boundary.\nMonitor cost and performance metrics Monitoring relevant metrics is essential to continually improve the workload design and performance. Some things to keep an eye on -\nAnalyse network traffic patterns using vpc flow logs to identify cross-AZ traffic. Use network manager to monitor inter/intra-AZ latency specific information. Analyse data transfer charges using cost and usage reports to identify cross-AZ traffic, and optimise workloads. Examples Using transit gateway to inspect all ingress/egress traffic A workload in VPC A (application account) connects to the AD controller deployed in VPC B (shared services account) through the transit gateway (shared networking account)\n[East-West-VPC-to-VPC-traffic-inspection-scenario.png]\nCentralized egress with ingress/egress inspection All egress traffic is routed through the transit gateway, and AZ specific NAT gateway. Separate NAT gateways should be provisioned in each AZ to avoid cross traffic.\nNote the route table in the central egress TGW subnet. While sending traffic to internet, care should be taken to prevent [[Work/Network#Private IPs|private IPs]] from hitting the public internet. So, be sure to add routes like 10.0.0.0/8, 100.64.0.0/18, 192.168.0.0, 172.168.0.0\n[Routing-traffic-through-NAT-Gateway.png]\nCentralized ingress with ingress/egress inspection Incoming internet is accepted by the internet gateway, and passed to the ALB, which in turn routes it to the destination app workload via the transit gateway, and inspection appliance.\nThe key steps to note here are 2, and 10. Load balancer (cross-zone disabled) picks a network interface in the same AZ (AZ B) as the destination. If cross-zone is enabled, it can pick any AZ, so a scenario like 10a becomes possible/probable.\n[AZ-aware-load-balancing-scenario.png]\nStorage service spanning multiple AZ Figure shows a storage service which has 3 different components. A request router, worker nodes (lead, tail, and middle), and a load balancer (cross-zone load balancing = enabled).\nThis architecture results in data transfer across AZ about 8 times. This can add performance overhead as cross AZ latency is in single digit ms compared to communication within an AZ, where latency is sub ms (\u003c 1 ms).\nImprovements Switch from ALB to NLB (cross-zone disabled, static ip in each AZ) Create AZ specific DNS endpoints using the NLB network interface in AZ, like euw1-az1.foo.com Clients use the AZ specific DNS name above. This ties the clients to a specific AZ and reduce the benefit of using multiple AZ. Implement a client library to include logic for retries with exponential backoff, circuit breakers etc for cases when an AZ fails. The clients should be able to switch to a healthy AZ. Implement service discovery to reduce the need of LB, clients can directly connect to their AZ specific request routers (see figure above). Full post\nReferences https://community.aws/posts/improving-availability-and-performance-with-multi-az-architecture\nhttps://aws.amazon.com/blogs/networking-and-content-delivery/centralized-inspection-architecture-with-aws-gateway-load-balancer-and-aws-transit-gateway/\nhttps://aws.amazon.com/builders-library/static-stability-using-availability-zones/\n","wordCount":"1004","inLanguage":"en","datePublished":"2024-02-15T00:00:00Z","dateModified":"2025-04-04T12:48:24+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://abiydv.github.io/notes/aws/multi-az-rchitectures/"},"publisher":{"@type":"Organization","name":"@abiydv","logo":{"@type":"ImageObject","url":"https://abiydv.github.io/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://abiydv.github.io/ accesskey=h title="@abiydv (Alt + H)">@abiydv</a><div class=logo-switches></div></div><ul id=menu><li><a href=https://abiydv.github.io/ title=Home><span>Home</span></a></li><li><a href=https://abiydv.github.io/about/ title=About><span>About</span></a></li><li><a href=https://abiydv.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://abiydv.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://abiydv.github.io/notes/ title=Notes><span>Notes</span></a></li><li><a href=https://abiydv.github.io/search title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://abiydv.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://abiydv.github.io/notes/>Notes</a>&nbsp;»&nbsp;<a href=https://abiydv.github.io/notes/aws/>AWS</a></div><h1 class=post-title>Multi-AZ Architectures<sup>&nbsp;<span class="entry-stage sandbox">&nbsp;sandbox&nbsp;</span></sup></h1><div class=post-meta><s>15.2.24</s>&nbsp;4.4.25 / Notes / 5 min</div></header><div class=post-content><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#questions aria-label=Questions>Questions</a><ul><li><a href=#what-is-an-az aria-label="What is an AZ?">What is an AZ?</a></li><li><a href=#why-use-multiple-az aria-label="Why use multiple AZ?">Why use multiple AZ?</a></li><li><a href=#is-route53-az-aware aria-label="Is Route53 AZ aware?">Is Route53 AZ aware?</a></li></ul></li><li><a href=#challenges aria-label=Challenges>Challenges</a><ul><li><a href=#random-az-name-to-az-id-mapping aria-label="Random AZ name to AZ id mapping">Random AZ name to AZ id mapping</a></li><li><a href=#no-visibility-to-others-az-choices aria-label="No visibility to others&amp;rsquo; AZ choices">No visibility to others&rsquo; AZ choices</a></li></ul></li><li><a href=#guidelines aria-label=Guidelines>Guidelines</a><ul><li><a href=#manage-az-assignments-centrally aria-label="Manage AZ assignments centrally">Manage AZ assignments centrally</a></li><li><a href=#az-aware-shared-networking aria-label="AZ aware shared networking">AZ aware shared networking</a></li><li><a href=#disable-cross-zone-load-balancing aria-label="Disable cross-zone load balancing">Disable cross-zone load balancing</a></li><li><a href=#use-az-local-resources aria-label="Use AZ local resources">Use AZ local resources</a></li><li><a href=#monitor-cost-and-performance-metrics aria-label="Monitor cost and performance metrics">Monitor cost and performance metrics</a></li></ul></li><li><a href=#examples aria-label=Examples>Examples</a><ul><li><a href=#using-transit-gateway-to-inspect-all-ingressegress-traffic aria-label="Using transit gateway to inspect all ingress/egress traffic">Using transit gateway to inspect all ingress/egress traffic</a></li><li><a href=#centralized-egress-with-ingressegress-inspection aria-label="Centralized egress with ingress/egress inspection">Centralized egress with ingress/egress inspection</a></li><li><a href=#centralized-ingress-with-ingressegress-inspection aria-label="Centralized ingress with ingress/egress inspection">Centralized ingress with ingress/egress inspection</a></li><li><a href=#storage-service-spanning-multiple-az aria-label="Storage service spanning multiple AZ">Storage service spanning multiple AZ</a><ul><li><a href=#improvements aria-label=Improvements>Improvements</a></li></ul></li></ul></li><li><a href=#references aria-label=References>References</a></li></ul></div></details></div></div><div class=post-content><h1 id=questions>Questions<a hidden class=anchor aria-hidden=true href=#questions>#</a></h1><p>What is the scope? AZ, Regional, Global</p><p>When or why will you choose both <a href=/notes/aws/cloudfront/>CloudFront</a> <em>AND</em> <a href=/notes/aws/load-balancers/>Load balancer</a>?</p><h2 id=what-is-an-az>What is an AZ?<a hidden class=anchor aria-hidden=true href=#what-is-an-az>#</a></h2><ul><li>AZ or <em>availability zone</em> is an independent data center within a specific geographic region.</li><li>An AWS Region is a collection of multiple availability zones.</li><li>Regarded as a fault boundary.</li><li>Data transfer across AZ is <em>not free</em>.</li><li>Cross AZ traffic should be controlled for <a href=/notes/aws/aws-well-architected/#c-cost-optimization>cost optimization</a> and <a href=/notes/aws/aws-well-architected/#p-performance-efficiency>performance efficiency</a>.</li></ul><h2 id=why-use-multiple-az>Why use multiple AZ?<a hidden class=anchor aria-hidden=true href=#why-use-multiple-az>#</a></h2><ul><li>Improves <a href=/notes/aws/aws-well-architected/#r-reliability>reliability</a> since failures in one AZ do not cause full outage of the workload.</li><li>Improves <a href=/notes/aws/aws-well-architected/#p-performance-efficiency>performance</a> by reducing latency.</li><li>Helpful in disaster recovery?</li></ul><h2 id=is-route53-az-aware>Is Route53 AZ aware?<a hidden class=anchor aria-hidden=true href=#is-route53-az-aware>#</a></h2><p><em>In the example with app servers trying to reach the AD domain controller, how does the name resolution help keep the traffic in the same AZ?</em></p><p>Create AZ specific DNS entries using network interfaces in the same AZ. For ex - NLB provides a static IP for network interface in each AZ. Use this to create endpoints such as euw-az1.myservice.com, instead of letting clients use myservice.com.</p><h1 id=challenges>Challenges<a hidden class=anchor aria-hidden=true href=#challenges>#</a></h1><h2 id=random-az-name-to-az-id-mapping>Random AZ name to AZ id mapping<a hidden class=anchor aria-hidden=true href=#random-az-name-to-az-id-mapping>#</a></h2><ul><li>AWS maps AZ names to <em>different</em> AZ ids in each account, to distribute load more evenly across all it&rsquo;s data centers.</li><li>AZ name format is <code>eu-west-1a</code>, where as AZ id format is <code>euw1-az1</code>.</li><li><em>AZ name to AZ id mapping can differ between accounts. AZ id is the same everywhere.</em>
Example from an AWS Account (<code>eu-west-1</code> region) -> EC2 Dashboard</li></ul><table><thead><tr><th>AZ name</th><th>AZ ID</th></tr></thead><tbody><tr><td>eu-west-1a</td><td>euw1-az3</td></tr><tr><td>eu-west-1b</td><td>euw1-az1</td></tr><tr><td>eu-west-1c</td><td>euw1-az2</td></tr></tbody></table><h2 id=no-visibility-to-others-az-choices>No visibility to others&rsquo; AZ choices<a hidden class=anchor aria-hidden=true href=#no-visibility-to-others-az-choices>#</a></h2><p>Multi-account setups usually have multiple <a href=/notes/aws/vpc/#vpc-peering>VPC peering</a> and/or <a href=/notes/aws/transit-gateway/#attachment-types>transit gateway attachments</a>, often with differing AZ choices.</p><p>One team may not be aware of the other teams&rsquo; AZ choices. This can cause traffic to cross the AZ boundary when workloads deployed in different accounts/VPCs need to interact.</p><h1 id=guidelines>Guidelines<a hidden class=anchor aria-hidden=true href=#guidelines>#</a></h1><p>Due to the above mentioned challenges of multi-AZ architectures, it is important to follow some guidelines when designing.</p><h2 id=manage-az-assignments-centrally>Manage AZ assignments centrally<a hidden class=anchor aria-hidden=true href=#manage-az-assignments-centrally>#</a></h2><p>Just like managing VPC CIDR ranges centrally with <a href=/notes/aws/ipam/>IPAM</a>, manage the preferred AZ centrally as well.</p><p>Example, when using VPC with CIDR range of <code>/16</code>, it can be divided further into <code>/20</code> blocks. The first two <code>/20</code> blocks can then be used in the first two AZs in all accounts. This greatly simplifies the routing table of the <a href=/notes/aws/transit-gateway/>Transit Gateway</a> in the shared network account.</p><table><thead><tr><th>VPC range</th><th>AZ 1 range</th><th>AZ 2 range</th></tr></thead><tbody><tr><td><code>10.1.0.0/16</code></td><td><code>10.1.0.0/20</code></td><td><code>10.1.16.0/20</code></td></tr></tbody></table><h2 id=az-aware-shared-networking>AZ aware shared networking<a hidden class=anchor aria-hidden=true href=#az-aware-shared-networking>#</a></h2><p><a href=/notes/aws/transit-gateway/>AWS Transit Gateway</a> is AZ aware (except in <a href=/notes/aws/transit-gateway/#appliance-mode>appliance mode</a>) and keeps the traffic in the same AZ as source, until it reaches the destination or is routed to a different AZ. Refer <a href=/notes/aws/multi-az-rchitectures/#examples>examples</a>.</p><p>When attaching a TGW to a VPC, use the same AZ that subnets in the VPC use.</p><h2 id=disable-cross-zone-load-balancing>Disable cross-zone load balancing<a hidden class=anchor aria-hidden=true href=#disable-cross-zone-load-balancing>#</a></h2><p><a href=/notes/aws/load-balancers/>Load Balancers</a> route traffic across AZ, by default (cross-zone load balancing = enabled). Consider disabling cross-zone load balancing when using cross-account load balancer. Be aware of the following trade-offs</p><ul><li>Capacity planning in each AZ to ensure adequate redundancy</li><li>No support for <a href=/notes/aws/load-balancers/>stickiness</a></li></ul><p><a href=/notes/aws/load-balancers/#aws-network-load-balancer>AWS Network Load Balancer</a> <em>does not</em> route traffic across AZ, by default (cross-zone load balancing = disabled).</p><h2 id=use-az-local-resources>Use AZ local resources<a hidden class=anchor aria-hidden=true href=#use-az-local-resources>#</a></h2><p>Use local resources within the AZ, if possible.</p><p>Example, if there are AD controllers an app needs to reach, consider configuring the app instances in each AZ with the address of the AD controller of that specific AZ. This would ensure there is no risk of traffic crossing the AZ boundary.</p><h2 id=monitor-cost-and-performance-metrics>Monitor cost and performance metrics<a hidden class=anchor aria-hidden=true href=#monitor-cost-and-performance-metrics>#</a></h2><p><a href=./monitoring.md>Monitoring</a> relevant metrics is essential to continually improve the workload design and performance. Some things to keep an eye on -</p><ul><li>Analyse network traffic patterns using <a href=/notes/aws/vpc/>vpc flow logs</a> to identify cross-AZ traffic.</li><li>Use <a href=https://docs.aws.amazon.com/managedservices/latest/userguide/networking-manager.html>network manager</a> to monitor inter/intra-AZ latency specific information.</li><li>Analyse data transfer charges using <a href=/notes/aws/billing-and-cost/#cost-and-usage-report>cost and usage reports</a> to identify cross-AZ traffic, and optimise workloads.</li></ul><h1 id=examples>Examples<a hidden class=anchor aria-hidden=true href=#examples>#</a></h1><h2 id=using-transit-gateway-to-inspect-all-ingressegress-traffic>Using transit gateway to inspect all ingress/egress traffic<a hidden class=anchor aria-hidden=true href=#using-transit-gateway-to-inspect-all-ingressegress-traffic>#</a></h2><p>A workload in VPC A (application account) connects to the AD controller deployed in VPC B (shared services account) through the transit gateway (shared networking account)</p><p>[East-West-VPC-to-VPC-traffic-inspection-scenario.png]</p><h2 id=centralized-egress-with-ingressegress-inspection>Centralized egress with ingress/egress inspection<a hidden class=anchor aria-hidden=true href=#centralized-egress-with-ingressegress-inspection>#</a></h2><p>All egress traffic is routed through the transit gateway, and AZ specific NAT gateway. Separate NAT gateways should be provisioned in each AZ to avoid cross traffic.</p><p>Note the route table in the central egress TGW subnet. While sending traffic to internet, care should be taken to prevent [[Work/Network#Private IPs|private IPs]] from hitting the public internet. So, be sure to add routes like <code>10.0.0.0/8</code>, <code>100.64.0.0/18</code>, <code>192.168.0.0</code>, <code>172.168.0.0</code></p><p>[Routing-traffic-through-NAT-Gateway.png]</p><h2 id=centralized-ingress-with-ingressegress-inspection>Centralized ingress with ingress/egress inspection<a hidden class=anchor aria-hidden=true href=#centralized-ingress-with-ingressegress-inspection>#</a></h2><p>Incoming internet is accepted by the internet gateway, and passed to the ALB, which in turn routes it to the destination app workload via the transit gateway, and inspection appliance.</p><p>The key steps to note here are <em>2</em>, and <em>10</em>. Load balancer (cross-zone disabled) picks a network interface in the same AZ (AZ B) as the destination. If cross-zone is enabled, it can pick any AZ, so a scenario like <em>10a</em> becomes possible/probable.</p><p>[AZ-aware-load-balancing-scenario.png]</p><h2 id=storage-service-spanning-multiple-az>Storage service spanning multiple AZ<a hidden class=anchor aria-hidden=true href=#storage-service-spanning-multiple-az>#</a></h2><p>Figure shows a storage service which has 3 different components. A request router, worker nodes (lead, tail, and middle), and a load balancer (cross-zone load balancing = enabled).</p><p>This architecture results in data transfer across AZ about 8 times. This can add performance overhead as cross AZ latency is in single digit ms compared to communication within an AZ, where latency is sub ms (&lt; 1 ms).</p><p><img loading=lazy src=https://d2908q01vomqb2.cloudfront.net/fc074d501302eb2b93e2554793fcaf50b3bf7291/2021/09/23/Figure-1.-An-example-system-that-transfers-data-across-AZs.png alt=starting-out></p><h3 id=improvements>Improvements<a hidden class=anchor aria-hidden=true href=#improvements>#</a></h3><ul><li>Switch from ALB to NLB (cross-zone disabled, static ip in each AZ)</li><li>Create AZ specific DNS endpoints using the NLB network interface in AZ, like <code>euw1-az1.foo.com</code></li><li>Clients use the AZ specific DNS name above.</li><li>This ties the clients to a specific AZ and reduce the benefit of using multiple AZ.</li><li>Implement a client library to include logic for retries with exponential backoff, circuit breakers etc for cases when an AZ fails. The clients should be able to switch to a healthy AZ.</li><li>Implement service discovery to reduce the need of LB, clients can directly connect to their AZ specific request routers (see figure above).</li></ul><p><a href=https://aws.amazon.com/blogs/architecture/improving-performance-and-reducing-cost-using-availability-zone-affinity/>Full post</a></p><h1 id=references>References<a hidden class=anchor aria-hidden=true href=#references>#</a></h1><ul><li><p><a href=https://community.aws/posts/improving-availability-and-performance-with-multi-az-architecture>https://community.aws/posts/improving-availability-and-performance-with-multi-az-architecture</a></p></li><li><p><a href=https://aws.amazon.com/blogs/networking-and-content-delivery/centralized-inspection-architecture-with-aws-gateway-load-balancer-and-aws-transit-gateway/>https://aws.amazon.com/blogs/networking-and-content-delivery/centralized-inspection-architecture-with-aws-gateway-load-balancer-and-aws-transit-gateway/</a></p></li><li><p><a href=https://aws.amazon.com/builders-library/static-stability-using-availability-zones/>https://aws.amazon.com/builders-library/static-stability-using-availability-zones/</a></p></li></ul></div><footer class=post-footer><hr><div class=align-center><div class=slimlist-entry><h2>Topics</h2></div><ul class=post-tags><div class=slimlist-entry><li class=post-tags><a href=https://abiydv.github.io/topics/aws/>aws</a></li><li class=post-tags><a href=https://abiydv.github.io/topics/stage-sandbox/>stage/sandbox</a></li><li class=post-tags><a href=https://abiydv.github.io/topics/architecture/>architecture</a></li></div></ul></div></footer><script src=https://utteranc.es/client.js repo=abiydv/abiydv.github.io issue-term=title label=Comment theme=github-light crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2019-2025 <a href=https://abiydv.github.io/>@abiydv</a> / </span><span>Published 4.4.25 /
</span><span>Thanks <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a>, <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script></body></html>