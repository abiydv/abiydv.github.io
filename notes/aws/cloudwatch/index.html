<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>AWS CloudWatch | @abiydv</title>
<meta name=keywords content><meta name=description content="info FYI AWS use “CloudWatch” in docs, “cloudwatch“ in cli/sdk, “monitoring” as the API endpoint, and “cloud-watch” in other service API calls like when setting flow logs for VPC, log_destination_type = &ldquo;cloud-watch-logs&rdquo;
Custom log groups Now it&rsquo;s possible to use a custom log group for a lambda function. Use this to send logs from multiple lambda functions to the same log group - each function gets it&rsquo;s own log stream!"><meta name=author content><link rel=canonical href=https://abiydv.github.io/notes/aws/cloudwatch/><link crossorigin=anonymous href=/assets/css/stylesheet.c5edd088d0c984c192170cfbab7d2de030010ee0b7d771bd6bca049dd2332874.css integrity="sha256-xe3QiNDJhMGSFwz7q30t4DABDuC313G9a8oEndIzKHQ=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://abiydv.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://abiydv.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://abiydv.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://abiydv.github.io/apple-touch-icon.png><link rel=mask-icon href=https://abiydv.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://abiydv.github.io/notes/aws/cloudwatch/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="AWS CloudWatch"><meta property="og:description" content="info FYI AWS use “CloudWatch” in docs, “cloudwatch“ in cli/sdk, “monitoring” as the API endpoint, and “cloud-watch” in other service API calls like when setting flow logs for VPC, log_destination_type = &ldquo;cloud-watch-logs&rdquo;
Custom log groups Now it&rsquo;s possible to use a custom log group for a lambda function. Use this to send logs from multiple lambda functions to the same log group - each function gets it&rsquo;s own log stream!"><meta property="og:type" content="article"><meta property="og:url" content="https://abiydv.github.io/notes/aws/cloudwatch/"><meta property="article:section" content="notes"><meta property="article:published_time" content="2024-02-14T00:00:00+00:00"><meta property="article:modified_time" content="2025-04-04T12:48:24+01:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="AWS CloudWatch"><meta name=twitter:description content="info FYI AWS use “CloudWatch” in docs, “cloudwatch“ in cli/sdk, “monitoring” as the API endpoint, and “cloud-watch” in other service API calls like when setting flow logs for VPC, log_destination_type = &ldquo;cloud-watch-logs&rdquo;
Custom log groups Now it&rsquo;s possible to use a custom log group for a lambda function. Use this to send logs from multiple lambda functions to the same log group - each function gets it&rsquo;s own log stream!"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Notes","item":"https://abiydv.github.io/notes/"},{"@type":"ListItem","position":2,"name":"AWS","item":"https://abiydv.github.io/notes/aws/"},{"@type":"ListItem","position":3,"name":"AWS CloudWatch","item":"https://abiydv.github.io/notes/aws/cloudwatch/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"AWS CloudWatch","name":"AWS CloudWatch","description":"info FYI AWS use “CloudWatch” in docs, “cloudwatch“ in cli/sdk, “monitoring” as the API endpoint, and “cloud-watch” in other service API calls like when setting flow logs for VPC, log_destination_type = \u0026ldquo;cloud-watch-logs\u0026rdquo;\nCustom log groups Now it\u0026rsquo;s possible to use a custom log group for a lambda function. Use this to send logs from multiple lambda functions to the same log group - each function gets it\u0026rsquo;s own log stream!","keywords":[],"articleBody":" info FYI AWS use “CloudWatch” in docs, “cloudwatch“ in cli/sdk, “monitoring” as the API endpoint, and “cloud-watch” in other service API calls like when setting flow logs for VPC, log_destination_type = “cloud-watch-logs”\nCustom log groups Now it’s possible to use a custom log group for a lambda function. Use this to send logs from multiple lambda functions to the same log group - each function gets it’s own log stream! Previously, every lambda function created it’s own cloudwatch log group (with a random suffix). This log group wasn’t removed up if the function was deleted. A log expiry duration like 7 days would only delete the log streams inside the log group. This resulted in proliferation of dead log groups which had to be deleted/cleaned up manually. The problem is severe in accounts where there are lots for short lived lambda deployments, like lower development environments.\nRef\ncloudwatch log query fields @timestamp, eventSource, eventName, @message | filter ispresent(errorCode) and readOnly = 0 and userIdentity.accountId = '000123456789' fields @timestamp, recipientAccountId, eventName, eventSource, userIdentity.arn, @message | filter eventName in [\"RunInstances\",\"AttachInternetGateway\",\"CreateEgressOnlyInternetGateway\",\"AssociateAddress\",\"CreateVpcPeeringConnection\",\"AcceptVpcPeeringConnection\"] and not ispresent(errorCode) fields @timestamp, recipientAccountId, eventName, eventSource, userIdentity.arn, @message | filter eventName in [\"RunInstances\"] and not ispresent(errorCode) | filter requestParameters.networkInterfaceSet.items.0.associatePublicIpAddress=0 cloudwatch Composite alarms can send Amazon SNS notifications when they change state, and can create Systems Manager OpsItems or incidents when they go into ALARM state, but can’t perform EC2 actions or Auto Scaling actions.\n","wordCount":"234","inLanguage":"en","datePublished":"2024-02-14T00:00:00Z","dateModified":"2025-04-04T12:48:24+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://abiydv.github.io/notes/aws/cloudwatch/"},"publisher":{"@type":"Organization","name":"@abiydv","logo":{"@type":"ImageObject","url":"https://abiydv.github.io/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://abiydv.github.io/ accesskey=h title="@abiydv (Alt + H)">@abiydv</a><div class=logo-switches></div></div><ul id=menu><li><a href=https://abiydv.github.io/ title=Home><span>Home</span></a></li><li><a href=https://abiydv.github.io/about/ title=About><span>About</span></a></li><li><a href=https://abiydv.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://abiydv.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://abiydv.github.io/notes/ title=Notes><span>Notes</span></a></li><li><a href=https://abiydv.github.io/search title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://abiydv.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://abiydv.github.io/notes/>Notes</a>&nbsp;»&nbsp;<a href=https://abiydv.github.io/notes/aws/>AWS</a></div><h1 class=post-title>AWS CloudWatch<sup>&nbsp;<span class="entry-stage sandbox">&nbsp;sandbox&nbsp;</span></sup></h1><div class=post-meta><s>14.2.24</s>&nbsp;4.4.25 / Notes / 2 min</div></header><div class=post-content><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#custom-log-groups aria-label="Custom log groups">Custom log groups</a></li><li><a href=#cloudwatch-log-query aria-label="cloudwatch log query">cloudwatch log query</a></li><li><a href=#cloudwatch aria-label=cloudwatch>cloudwatch</a></li></ul></div></details></div></div><div class=post-content><blockquote><p><strong>info</strong> FYI
AWS use “CloudWatch” in docs, “cloudwatch“ in cli/sdk, “monitoring” as the API endpoint, and “cloud-watch” in other service API calls like when setting flow logs for VPC, log_destination_type = &ldquo;cloud-watch-logs&rdquo;</p></blockquote><h1 id=custom-log-groups>Custom log groups<a hidden class=anchor aria-hidden=true href=#custom-log-groups>#</a></h1><p>Now it&rsquo;s possible to use a <em>custom</em> log group for a lambda function. Use this to send logs from multiple lambda functions to the <em>same</em> log group - each function gets it&rsquo;s own log stream!
Previously, every lambda function created it&rsquo;s own cloudwatch log group (with a random suffix). This log group wasn&rsquo;t removed up if the function was deleted. A log expiry duration like 7 days would only delete the log streams inside the log group. This resulted in proliferation of dead log groups which had to be deleted/cleaned up manually. The problem is severe in accounts where there are lots for short lived lambda deployments, like lower development environments.</p><p><a href=https://aws.amazon.com/blogs/compute/introducing-advanced-logging-controls-for-aws-lambda-functions/>Ref</a></p><h1 id=cloudwatch-log-query>cloudwatch log query<a hidden class=anchor aria-hidden=true href=#cloudwatch-log-query>#</a></h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>fields <span style=color:#f92672>@</span><span style=color:#66d9ef>timestamp</span>, eventSource, eventName, <span style=color:#f92672>@</span>message
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> filter ispresent(errorCode) <span style=color:#66d9ef>and</span> readOnly <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>and</span> userIdentity.accountId <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;000123456789&#39;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>fields <span style=color:#f92672>@</span><span style=color:#66d9ef>timestamp</span>, recipientAccountId, eventName, eventSource, userIdentity.arn, <span style=color:#f92672>@</span>message
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> filter eventName <span style=color:#66d9ef>in</span> [<span style=color:#e6db74>&#34;RunInstances&#34;</span>,<span style=color:#e6db74>&#34;AttachInternetGateway&#34;</span>,<span style=color:#e6db74>&#34;CreateEgressOnlyInternetGateway&#34;</span>,<span style=color:#e6db74>&#34;AssociateAddress&#34;</span>,<span style=color:#e6db74>&#34;CreateVpcPeeringConnection&#34;</span>,<span style=color:#e6db74>&#34;AcceptVpcPeeringConnection&#34;</span>] <span style=color:#66d9ef>and</span> <span style=color:#66d9ef>not</span> ispresent(errorCode)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>fields <span style=color:#f92672>@</span><span style=color:#66d9ef>timestamp</span>, recipientAccountId, eventName, eventSource, userIdentity.arn, <span style=color:#f92672>@</span>message
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> filter eventName <span style=color:#66d9ef>in</span> [<span style=color:#e6db74>&#34;RunInstances&#34;</span>] <span style=color:#66d9ef>and</span> <span style=color:#66d9ef>not</span> ispresent(errorCode)
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> filter requestParameters.networkInterfaceSet.items.<span style=color:#ae81ff>0</span>.associatePublicIpAddress<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span></code></pre></div><h1 id=cloudwatch>cloudwatch<a hidden class=anchor aria-hidden=true href=#cloudwatch>#</a></h1><p>Composite alarms can send Amazon SNS notifications when they change state, and can create Systems Manager OpsItems or incidents when they go into ALARM state, but can&rsquo;t perform EC2 actions or Auto Scaling actions.</p></div><footer class=post-footer><hr><div class=align-center><div class=slimlist-entry><h2>Topics</h2></div><ul class=post-tags><div class=slimlist-entry><li class=post-tags><a href=https://abiydv.github.io/topics/aws/>aws</a></li><li class=post-tags><a href=https://abiydv.github.io/topics/stage-sandbox/>stage/sandbox</a></li><li class=post-tags><a href=https://abiydv.github.io/topics/monitoring/>monitoring</a></li><li class=post-tags><a href=https://abiydv.github.io/topics/alerting/>alerting</a></li></div></ul></div></footer><script src=https://utteranc.es/client.js repo=abiydv/abiydv.github.io issue-term=title label=Comment theme=github-light crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2019-2025 <a href=https://abiydv.github.io/>@abiydv</a> / </span><span>Published 4.4.25 /
</span><span>Thanks <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a>, <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script></body></html>