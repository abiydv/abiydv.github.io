<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>AWS Virtual Private Cloud (VPC) | @abiydv</title>
<meta name=keywords content><meta name=description content="What is a VPC? Virtual Private Cloud
An isolated virtual network present in your AWS account. There is a default VPC present. However, it is recommended to create your own custom VPC based on your environment.
You can create a IPv4 only or Dual stack (IPv4 + IPv6) VPC.
Default VPC You can modify, delete, recreate a default VPC Creating a default VPC does not need VPC specific permissions as all resources are created by AWS"><meta name=author content><link rel=canonical href=https://abiydv.github.io/notes/aws/vpc/><link crossorigin=anonymous href=/assets/css/stylesheet.c5edd088d0c984c192170cfbab7d2de030010ee0b7d771bd6bca049dd2332874.css integrity="sha256-xe3QiNDJhMGSFwz7q30t4DABDuC313G9a8oEndIzKHQ=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://abiydv.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://abiydv.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://abiydv.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://abiydv.github.io/apple-touch-icon.png><link rel=mask-icon href=https://abiydv.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://abiydv.github.io/notes/aws/vpc/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="AWS Virtual Private Cloud (VPC)"><meta property="og:description" content="What is a VPC? Virtual Private Cloud
An isolated virtual network present in your AWS account. There is a default VPC present. However, it is recommended to create your own custom VPC based on your environment.
You can create a IPv4 only or Dual stack (IPv4 + IPv6) VPC.
Default VPC You can modify, delete, recreate a default VPC Creating a default VPC does not need VPC specific permissions as all resources are created by AWS"><meta property="og:type" content="article"><meta property="og:url" content="https://abiydv.github.io/notes/aws/vpc/"><meta property="article:section" content="notes"><meta property="article:published_time" content="2024-02-14T00:00:00+00:00"><meta property="article:modified_time" content="2025-04-04T12:48:24+01:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="AWS Virtual Private Cloud (VPC)"><meta name=twitter:description content="What is a VPC? Virtual Private Cloud
An isolated virtual network present in your AWS account. There is a default VPC present. However, it is recommended to create your own custom VPC based on your environment.
You can create a IPv4 only or Dual stack (IPv4 + IPv6) VPC.
Default VPC You can modify, delete, recreate a default VPC Creating a default VPC does not need VPC specific permissions as all resources are created by AWS"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Notes","item":"https://abiydv.github.io/notes/"},{"@type":"ListItem","position":2,"name":"AWS","item":"https://abiydv.github.io/notes/aws/"},{"@type":"ListItem","position":3,"name":"AWS Virtual Private Cloud (VPC)","item":"https://abiydv.github.io/notes/aws/vpc/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"AWS Virtual Private Cloud (VPC)","name":"AWS Virtual Private Cloud (VPC)","description":"What is a VPC? Virtual Private Cloud\nAn isolated virtual network present in your AWS account. There is a default VPC present. However, it is recommended to create your own custom VPC based on your environment.\nYou can create a IPv4 only or Dual stack (IPv4 + IPv6) VPC.\nDefault VPC You can modify, delete, recreate a default VPC Creating a default VPC does not need VPC specific permissions as all resources are created by AWS","keywords":[],"articleBody":"What is a VPC? Virtual Private Cloud\nAn isolated virtual network present in your AWS account. There is a default VPC present. However, it is recommended to create your own custom VPC based on your environment.\nYou can create a IPv4 only or Dual stack (IPv4 + IPv6) VPC.\nDefault VPC You can modify, delete, recreate a default VPC Creating a default VPC does not need VPC specific permissions as all resources are created by AWS\nCustom A custom VPC can not be marked as default even if there is no default VPC in the region.\nVPC CIDR Blocks When creating a VPC you must specify an IPv4 CIDR range. This becomes the VPC’s primary CIDR range. All private ranges defined in RFC#1918 are valid to be used -\n10.0/8 172.16/12 192.168/16 100.64/10 (CGNAT) The largest and smallest VPC CIDR ranges that can be specified are /16 and /28 respectively. Yes, you cannot create a /8 VPC, and the smallest VPC /28 only has 14 usable IPs.\nSubnet mask for prefix /28 = 255.255.255.240 Total IPs = 10.0.0.0 to 10.0.0.15 (16 IPs). Usable IPs = 10.0.0.1 to 10.0.0.14 (14 IPs)\nDANGER Avoid using the Docker default bridge range 172.17.0.0/16 as a CIDR range for a VPC, since it may cause conflicts with some AWS services that use the same range like SageMaker.\nConstraints You can assign a secondary CIDR range to a VPC with some constraints as follows\nIP range Restricted Allowed 10.0/8 198.19/16172.16/12192.168/16 Non-overlapping range from 10.0/8100.64/10Any other public range 172.16/12 198.19/1610.0/8192.168/16 Non-overlapping range from 172.16/12100.64/10Any other public range 192.168/16 198.19/1610.0/8172.16/12 Non-overlapping range from 192.168/16100.64/10Any other public range 198.19/16 10.0/8172.16/12192.168/16 100.64/10Any other public range Any other public range, or 100.64/10 198.19/1610.0/8172.16/12192.168/16 Non-overlapping range from 100.64/10Any other public range Subnet CIDR Blocks Subnet CIDR block can be the same as VPC CIDR block - 1 subnet in a VPC. Or, it can be a subset of the VPC CIDR block to create multiple subnets in a VPC.\nSubnet CIDR blocks cannot overlap each other.\nSimilar to VPC CIDR block, the largest, and smallest CIDR block for subnets are /16 (~65 IPs ) and /28 (~14 IPs).\nAWS reserves 5 IPs in each subnet block. For example, in a subnet with CIDR block 10.0.0.0/24, following IPs are reserved by AWS\n10.0.0.0 Network Address 10.0.0.1 VPC Router 10.0.0.2 DNS server, usually, network range + 2 route53 10.0.0.3 Future use 10.0.0.255 Network broadcast address. No broadcasr support in VPC, so reserved. Prefix Lists A collection of CIDR block entries (and an optional description).\nProperties Supports both IPv4, IPv6, but these cannot be mixed in the same list. Region specific Needs a maximum entry count while creation. Can be expanded later. Resources referencing them always use the latest version Can be shared with other account using AWS Resource Access Manager Weight of an AWS managed prefix list is the number of entries it takes up in a resource. For ex - cloudfront prefix list weight is 55, so it takes up 55 entries in a security group. Types AWS Managed AWS service CIDR blocks, you can not edit, share, delete, add these.\nCustomer managed Useful for sharing commonly used CIDR blocks in a customer’s environment.\nSecurity Groups Endpoints VPC endpoints are virtual devices enabling connectivity for compute or services within a VPC.\nTypes Interface Collection of managed ENIs with private IP to access AWS services (except dynamodb, s3), custom services, services from marketplace privately.\nGateway Load Balancer Route traffic to a fleet of virtual appliances using private IPs.\nGateway Targets specific IP routes Prefix Lists for traffic destined for AWS DynamoDB and AWS S3\nIngress Routing Here, the custom route table attached to the [[internet-gateway|AWS Internet Gateway]] forwards all incoming traffic to the network interface (eni0) of an EC2 instance. This instance could be running a security appliance like network-firewall to inspect the traffic.\nSimilarly, the route table for application subnet has a route which forwards all internet bound traffic to the instance’s network interface. Note: The appliance doesn’t do any NAT, so the internet communication is based on the public IP of the workload instance.\nHow to distribute workloads in VPCs? There are multiple ways to distribute workloads across different VPCs. Each approach has it’s pros and cons, so they should be evaluated based on the customer’s specific requirements.\nBased on Environment (dev, prod, shared services). Based on Compliance needs like public facing services, internal only, PCI compliant resources etc. Based on data sovernity restrictions (US, EU etc.) - across different regions. Based on company structure, these can be seggregated further into their own specific accounts for each company division and so on. VPC to VPC Connectivity As the number of VPCs increase in a customer’s environment, the next obvious question that arises is, how to maintain connectivity between different VPCs, between VPCs and on-prem systems etc.\nThere are 2 broad approaches to establishing such connections. They are -\nPoint to point - Traffic flows between specific VPCs. Hub and spoke - Traffic flows via a central resource based on certain defined rules. VPC Peering Point to point connectivity model.\nThis is a point to point connectivity method in which 2 VPCs are connected directly. It allows bidirectional traffic to flow between them. It does not support transitive connectivity.\nVPC A peered with VPC B, and VPC B peered with VPC C. Traffic from VPC A cannot reach VPC C via B. To enable connectivity between A \u0026 C, a new peering connection must be estabished.\nMaximum limit of 125 peering connections per VPC, so this does not scale very well.\nLowest cost for connecting VPCs since the charges are only for the traffic passing through the connection, there is no standing cost.\nWhen using a VPN, or [[direct-connect|Direct Connect]], each VPC must be connected individually to the DC or VPN. Peering does not support transitive routing, remember?\nWorks cross-region, cross-account.\nBest suited for VPCs less than 10.\nTraffic isolation can be achieved using security groups on specific resources (or NACLs as well?).\nTransit Gateway A hub-and-spoke model using Transit Gateway. Cost implications.\nTransit VPC A hub-and-spoke model.\nIn this solution, a central VPC with customer managed software appliances is used to route traffic between various connected networks. All VPCs can connect to this central VPC to gain access to the connected network. This is similar to Transit Gateway solution but is managed by customer.\nTransitive connectivity is provided by a VPN overlay network using BGP IPSec.\nThe central VPC contains EC2 instances running software appliances that route the traffic to their destination using the VPN overlay network.\nCustomers can use the same L7 Firewall, IDP, IPS products for their on-prem/cloud workloads if using a vendor provided product as the software appliance.\nNot very high performance - limited throughput of 1.2 Gbps/VPN tunnel.\nIt brings in additional complexity, cost, administrative and performance challenges.\n[[private-link|AWS Private Link]] Access AWS services, 3rd party SAAS apps directly in your VPC without traversing the internet.\nVPC Lattice Abstracts away the network complexity for application developers.\nIt creates logical application network layer called service network which allows service to service communication across VPC, regions, accounts over HTTP/HTTPS, or gRPC. It operates on a data plane in the VPC using the link local address layer 169.254/16 RFC#3927. This data plane is exposed via an endpoint within the VPC. Once a service network is associated with a VPC, services deployed within the VPC can discover other services made available by the service network.\nQUESTION In the above diagram, while VPC1, 3 are associated with the service network, VPC2 isn’t. So what’s the impact of this? All 3 services are associated with the service network meaning they are discoverable by resources running in VPCs associted with the service network i.e. resources in VPC1, 3. But, they aren’t discoverable from VPC2. This means the service in VPC2 doesn’t really depend on any other service and just responds to requests received.\nService An independent software unit that performs a specific function. While configuring a service with a service network, you use similar resources like a load balancer - listners, routing rules and target groups.\nService directory Central directory (at account level) of registered services, either deployed in the same account or shared via AWS Resource Access Manager.\nService network Logical grouping of services to enable connectivity and apply common policies\nAuth Policy Resource policy to ensure only authenticated and authorized clients use the services\nVPC Sharing VPC and/or subnets can be shared across accounts in an Org using AWS Resource Access Manager.\nThis is a low cost, low operational overhead solution, however, quite permissive in terms to network isolation.\nNetwork isolation can be improved by using grouping apps by behaviour and using separate subnets with relevant NACL for each group. Further isolation can be achieved by using security groups.\nPrivate NAT Gateway Connect networks with overlapping CIDR blocks.\nINFO Here, the 2 VPCs have non-routable overlapping range of 100.64/16. Based on secondary CIDR [[#Constraints| constraints, select a non-overlapping routable CIDR block for both VPC. VPC A = 10.0.1.0/24, VPC B = 10.0.2.0/24 Now, subnets are created within this secondary range in both VPCs - 10.0.1.0/25, and 10.0.2.0/25. These new subnets are used to launch private NAT gateways which will do the address translation. The new subnets are attached to the transit gateway with appropriate routes defined to refer to each other. In the non-routable sunets, routes are updated to send all non-local requests to the NAT.\nAs per the VPC A non-routable subnet route table, the packet with destination of ALB IP (10.0.2.x) is headed to the private NAT in VPC A routable subnet. Private NAT does the network translation, and forwards the packet to the TGW attachement as per the VPC A routable subnet route table. As per the TGW route table, the packet is then forwarded to the ALB in VPC B routable subnets. The ALB then forwards the packet to the destination in VPC B non-routable subnet. Response follows a similar path back - 5, 6, 7, 8. Reference\nVPC peering vs. Transit VPC vs. Transit Gateway Comparison of VPC peering, Transit VPC, and Transit Gateway\nCriteria VPC peering Transit VPC Transit Gateway Architecture Full mesh VPN-based hub-and-spoke Attachments-based hub-and-spoke. Can be peered with other TGWs. Complexity Increases with VPC count Customer needs to maintain EC2 instance/HA AWS-managed service; increases with Transit Gateway count Scale 125 active Peers/VPC Depends on virtual router/EC2 5000 attachments per Region Segmentation Security groups Customer managed Transit Gateway route tables Latency Lowest Extra, due to VPN encryption overhead Additional Transit Gateway hop Bandwidth limit No limit Subject to EC2 instance bandwidth limits based on size/family Up to 50 Gbps (burst)/attachment Visibility VPC Flow Logs VPC Flow Logs and CloudWatch Metrics Transit Gateway Network Manager, VPC Flow Logs, CloudWatch Metrics Security group cross-referencing Supported Not supported Not supported Cost Data transfer EC2 hourly cost, VPN tunnels cost and data transfer Hourly per attachment, data processing, and data transfer Hybrid Connectivity There are 2 approaches to establish hybrid connectivity. Both utilize VPN, but differ in where and how the VPN connection terminates.\nOne to One In this case, each VPC is connected to the VPN individually using Direct Connect/Virtual Private Gateway.\nEdge Consolidation Connect the VPN to a central transit-gateway and then attach VPCs to this central Transit Gateway.\nOnce the approach is decided, there are 4 different ways to terminate VPN connection on AWS\nTransit Gateway Recommended option, to connect VPN to a central Transit Gateway. Cost = AWS Transit Gateway Pricing + AWS VPN pricing.\nEC2 Some customers might want to use 3rd party software products, so terminating the VPN on an EC2 instance is also an option. This is basically one to one connectivity.\nTo enable Edge consolidation, you can use the [[#Transit VPC]] pattern. However, the same drawbacks as highlighted in that section remain.\nThis is also an option when wanting to use GRE.\nVirtual Private Gateway VGW Great option when starting out, since this is a [[#One to One]] connectivity design where you need to configure this on a per VPC basis.\nOffers redundancy due to 2 tunnels/connection design.\nDoes not support ECMP for VPN connections so throughput is limited to 1.25 Gbps per tunnel.\nCost = AWS VPN pricing only, no charge for Virtual Private Gateway\nQuestion How are Virtual Private Gateway and Customer Gateways related?\non-prem ------ aws customer ------ aws virtual device ------ gateway ------ private gw ---- aws vpc |\u003c--------- site to site VPN connection ---------\u003e Question How are Virtual Private Gateway and Direct Connect related?\non-prem ---- direct ---- virtual --- aws virtual device ---- connect ---- interface --- private gw --- aws vpc Client VPN Endpoint Another option when starting out. This is a One to One connectivity design where you need to configure this on a per VPC basis, or make use of other VPC connectivity features to achieve an Edge Consolidation connectivity design.\nTo configure client VPN endpoint, you need -\nTarget Network - subnets in a VPC, 1 per AZ. Additional routes - local, to peered VPC or VPGW etc. Authentication Mechanism SAML 2.0 (Single IdP only) Mutual authentication, cert based - each client needs a new cert Active Directory Client CIDR block between /12 and /22 prefix/subnet mask. Server certificate in [[AWS Certificate Manager]] regardless of authentication mechanism selected Enable self service portal (optional) Enable split tunnel (optional) Once configured, download the client VPN configuration file, and use it to connect to the VPN endpoint. This file contains info like the DNS name of the VPN endpoint, authorization mechanism, client CIDR blocks to use etc.\nAuthorization Security groups (attached to the client VPN endpoint) and network based authorization rules using either AD attributes or IdP provided metadat like groups etc.\nSplit Tunnel Use this to send specific traffic to the AWS tunnel. By default, the client endpoint route adds a 0.0.0.0 route to the client which sends all traffic from the client machine to the AWS tunnel. This can increase data transfer costs if everything goes via AWS.\nSplit tunnel adds specific routes to the client device route table which ensures only the traffic destined for AWS is sent over the tunnel. When using split tunnel ensure to not have a 0.0.0.0 route in the client VPN, otherwise it will still send traffic not destined for AWS to the tunnel.\nDirect Connect Connect On-prem network to AWS backbone network.\nLimits 250 network interfaces per VPC.\nReferences https://aws.amazon.com/blogs/aws/new-vpc-ingress-routing-simplifying-integration-of-third-party-appliances/ https://aws.amazon.com/blogs/containers/eks-vpc-routable-ip-address-conservation/ https://aws.amazon.com/blogs/networking-and-content-delivery/designing-hyperscale-amazon-vpc-networks/ https://aws.amazon.com/blogs/networking-and-content-delivery/how-to-solve-private-ip-exhaustion-with-private-nat-solution/ https://docs.aws.amazon.com/vpc/latest/tgw/transit-gateway-appliance-scenario.html https://docs.aws.amazon.com/vpc/latest/tgw/transit-gateway-nat-igw.html https://docs.aws.amazon.com/vpc/latest/userguide/VPC_Route_Tables.html#gateway-route-table https://repost.aws/knowledge-center/vpc-analyze-inbound-traffic-nat-gateway ","wordCount":"2412","inLanguage":"en","datePublished":"2024-02-14T00:00:00Z","dateModified":"2025-04-04T12:48:24+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://abiydv.github.io/notes/aws/vpc/"},"publisher":{"@type":"Organization","name":"@abiydv","logo":{"@type":"ImageObject","url":"https://abiydv.github.io/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://abiydv.github.io/ accesskey=h title="@abiydv (Alt + H)">@abiydv</a><div class=logo-switches></div></div><ul id=menu><li><a href=https://abiydv.github.io/ title=Home><span>Home</span></a></li><li><a href=https://abiydv.github.io/about/ title=About><span>About</span></a></li><li><a href=https://abiydv.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://abiydv.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://abiydv.github.io/notes/ title=Notes><span>Notes</span></a></li><li><a href=https://abiydv.github.io/search title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://abiydv.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://abiydv.github.io/notes/>Notes</a>&nbsp;»&nbsp;<a href=https://abiydv.github.io/notes/aws/>AWS</a></div><h1 class=post-title>AWS Virtual Private Cloud (VPC)<sup>&nbsp;<span class="entry-stage incubating">&nbsp;incubating&nbsp;</span></sup></h1><div class=post-meta><s>14.2.24</s>&nbsp;4.4.25 / Notes / 12 min</div></header><div class=post-content><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#what-is-a-vpc aria-label="What is a VPC?">What is a VPC?</a><ul><li><a href=#default-vpc aria-label="Default VPC">Default VPC</a></li><li><a href=#custom aria-label=Custom>Custom</a></li></ul></li><li><a href=#vpc-cidr-blocks aria-label="VPC CIDR Blocks">VPC CIDR Blocks</a><ul><li><a href=#constraints aria-label=Constraints>Constraints</a></li></ul></li><li><a href=#subnet-cidr-blocks aria-label="Subnet CIDR Blocks">Subnet CIDR Blocks</a></li><li><a href=#prefix-lists aria-label="Prefix Lists">Prefix Lists</a><ul><li><a href=#properties aria-label=Properties>Properties</a></li><li><a href=#types aria-label=Types>Types</a><ul><li><a href=#aws-managed aria-label="AWS Managed">AWS Managed</a></li><li><a href=#customer-managed aria-label="Customer managed">Customer managed</a></li></ul></li></ul></li><li><a href=#security-groups aria-label="Security Groups">Security Groups</a></li><li><a href=#endpoints aria-label=Endpoints>Endpoints</a><ul><li><a href=#types-1 aria-label=Types>Types</a><ul><li><a href=#interface aria-label=Interface>Interface</a></li><li><a href=#gateway-load-balancer aria-label="Gateway Load Balancer">Gateway Load Balancer</a></li><li><a href=#gateway aria-label=Gateway>Gateway</a></li></ul></li></ul></li><li><a href=#ingress-routing aria-label="Ingress Routing">Ingress Routing</a></li><li><a href=#how-to-distribute-workloads-in-vpcs aria-label="How to distribute workloads in VPCs?">How to distribute workloads in VPCs?</a></li><li><a href=#vpc-to-vpc-connectivity aria-label="VPC to VPC Connectivity">VPC to VPC Connectivity</a></li><li><a href=#vpc-peering aria-label="VPC Peering">VPC Peering</a></li><li><a href=#transit-gatewaytransit-gatewaymd aria-label="Transit Gateway"><a href=/notes/aws/transit-gateway/>Transit Gateway</a></a></li><li><a href=#transit-vpc aria-label="Transit VPC">Transit VPC</a></li><li><a href=#private-linkaws-private-link aria-label="[[private-link|AWS Private Link]]">[[private-link|AWS Private Link]]</a></li><li><a href=#vpc-lattice aria-label="VPC Lattice">VPC Lattice</a><ul><li><a href=#service aria-label=Service>Service</a></li><li><a href=#service-directory aria-label="Service directory">Service directory</a></li><li><a href=#service-network aria-label="Service network">Service network</a></li><li><a href=#auth-policy aria-label="Auth Policy">Auth Policy</a></li></ul></li><li><a href=#vpc-sharing aria-label="VPC Sharing">VPC Sharing</a></li><li><a href=#private-nat-gateway aria-label="Private NAT Gateway">Private NAT Gateway</a></li><li><a href=#vpc-peering-vs-transit-vpc-vs-transit-gateway aria-label="VPC peering vs. Transit VPC vs. Transit Gateway">VPC peering vs. Transit VPC vs. Transit Gateway</a></li><li><a href=#hybrid-connectivity aria-label="Hybrid Connectivity">Hybrid Connectivity</a><ul><li><a href=#one-to-one aria-label="One to One">One to One</a></li><li><a href=#edge-consolidation aria-label="Edge Consolidation">Edge Consolidation</a></li><li><a href=#transit-gateway aria-label="Transit Gateway">Transit Gateway</a></li><li><a href=#ec2 aria-label=EC2>EC2</a></li><li><a href=#virtual-private-gateway-vgw aria-label="Virtual Private Gateway VGW">Virtual Private Gateway VGW</a></li><li><a href=#client-vpn-endpoint aria-label="Client VPN Endpoint">Client VPN Endpoint</a></li><li><a href=#authorization aria-label=Authorization>Authorization</a></li><li><a href=#split-tunnel aria-label="Split Tunnel">Split Tunnel</a></li></ul></li><li><a href=#direct-connectdirect-connectmd aria-label="Direct Connect"><a href=/notes/aws/direct-connect/>Direct Connect</a></a></li><li><a href=#limits aria-label=Limits>Limits</a></li><li><a href=#references aria-label=References>References</a></li></ul></div></details></div></div><div class=post-content><h1 id=what-is-a-vpc>What is a VPC?<a hidden class=anchor aria-hidden=true href=#what-is-a-vpc>#</a></h1><p><em>Virtual Private Cloud</em></p><p>An isolated virtual network present in your AWS account. There is a <em>default</em> VPC present. However, it is recommended to create your own custom VPC based on your environment.</p><p>You can create a IPv4 only or Dual stack (IPv4 + IPv6) VPC.</p><h2 id=default-vpc>Default VPC<a hidden class=anchor aria-hidden=true href=#default-vpc>#</a></h2><p>You can modify, delete, recreate a default VPC
Creating a default VPC does not need VPC specific permissions as all resources are created by AWS</p><h2 id=custom>Custom<a hidden class=anchor aria-hidden=true href=#custom>#</a></h2><p>A custom VPC can not be marked as default even if there is no default VPC in the region.</p><h1 id=vpc-cidr-blocks>VPC CIDR Blocks<a hidden class=anchor aria-hidden=true href=#vpc-cidr-blocks>#</a></h1><p>When creating a VPC you must specify an IPv4 CIDR range. This becomes the VPC&rsquo;s <em>primary CIDR range</em>. All private ranges defined in <a href=/>RFC#1918</a> are valid to be used -</p><ol><li><code>10.0/8</code></li><li><code>172.16/12</code></li><li><code>192.168/16</code></li><li><code>100.64/10</code> (CGNAT)</li></ol><p>The largest and smallest VPC CIDR ranges that can be specified are <code>/16</code> and <code>/28</code> respectively. Yes, you <em>cannot</em> create a <code>/8</code> VPC, and the smallest VPC <code>/28</code> only has <code>14</code> usable IPs.</p><p>Subnet mask for prefix <code>/28</code> = <code>255.255.255.240</code>
Total IPs = <code>10.0.0.0</code> to <code>10.0.0.15</code> (16 IPs). Usable IPs = <code>10.0.0.1</code> to <code>10.0.0.14</code> (14 IPs)</p><blockquote><p><strong>DANGER</strong>
Avoid using the Docker default bridge range <code>172.17.0.0/16</code> as a CIDR range for a VPC, since it may cause conflicts with some AWS services that use the same range like SageMaker.</p></blockquote><h2 id=constraints>Constraints<a hidden class=anchor aria-hidden=true href=#constraints>#</a></h2><p>You can assign a <em>secondary CIDR range</em> to a VPC with some constraints as follows</p><table><thead><tr><th>IP range</th><th>Restricted</th><th>Allowed</th></tr></thead><tbody><tr><td><code>10.0/8</code></td><td><code>198.19/16</code><code>172.16/12</code><code>192.168/16</code></td><td>Non-overlapping range from <code>10.0/8</code><code>100.64/10</code>Any other public range</td></tr><tr><td><code>172.16/12</code></td><td><code>198.19/16</code><code>10.0/8</code><code>192.168/16</code></td><td>Non-overlapping range from <code>172.16/12</code><code>100.64/10</code>Any other public range</td></tr><tr><td><code>192.168/16</code></td><td><code>198.19/16</code><code>10.0/8</code><code>172.16/12</code></td><td>Non-overlapping range from <code>192.168/16</code><code>100.64/10</code>Any other public range</td></tr><tr><td><code>198.19/16</code></td><td><code>10.0/8</code><code>172.16/12</code><code>192.168/16</code></td><td><code>100.64/10</code>Any other public range</td></tr><tr><td>Any other public range, or <code>100.64/10</code></td><td><code>198.19/16</code><code>10.0/8</code><code>172.16/12</code><code>192.168/16</code></td><td>Non-overlapping range from <code>100.64/10</code>Any other public range</td></tr></tbody></table><h1 id=subnet-cidr-blocks>Subnet CIDR Blocks<a hidden class=anchor aria-hidden=true href=#subnet-cidr-blocks>#</a></h1><p>Subnet CIDR block can be the same as VPC CIDR block - 1 subnet in a VPC. Or, it can be a subset of the VPC CIDR block to create multiple subnets in a VPC.</p><p>Subnet CIDR blocks <em>cannot</em> overlap each other.</p><p>Similar to VPC CIDR block, the largest, and smallest CIDR block for subnets are <code>/16</code> (~65 IPs ) and <code>/28</code> (~14 IPs).</p><p>AWS reserves 5 IPs in each subnet block. For example, in a subnet with CIDR block <code>10.0.0.0/24</code>, following IPs are reserved by AWS</p><ol><li><code>10.0.0.0</code> Network Address</li><li><code>10.0.0.1</code> VPC Router</li><li><code>10.0.0.2</code> DNS server, usually, network range + 2 <a href=/notes/aws/route53/>route53</a></li><li><code>10.0.0.3</code> Future use</li><li><code>10.0.0.255</code> Network broadcast address. No broadcasr support in VPC, so reserved.</li></ol><h1 id=prefix-lists>Prefix Lists<a hidden class=anchor aria-hidden=true href=#prefix-lists>#</a></h1><p>A collection of CIDR block entries (and an optional description).</p><h2 id=properties>Properties<a hidden class=anchor aria-hidden=true href=#properties>#</a></h2><ul><li>Supports both IPv4, IPv6, but these cannot be mixed in the same list.</li><li>Region specific</li><li>Needs a maximum entry count while creation. Can be expanded later.</li><li>Resources referencing them always use the latest version</li><li>Can be shared with other account using <a href=/>AWS Resource Access Manager</a></li><li>Weight of an AWS managed prefix list is the number of entries it takes up in a resource. For ex - cloudfront prefix list weight is 55, so it takes up 55 entries in a <a href=/notes/aws/vpc/#security-groups>security group</a>.</li></ul><h2 id=types>Types<a hidden class=anchor aria-hidden=true href=#types>#</a></h2><h3 id=aws-managed>AWS Managed<a hidden class=anchor aria-hidden=true href=#aws-managed>#</a></h3><p>AWS service CIDR blocks, you can not edit, share, delete, add these.</p><h3 id=customer-managed>Customer managed<a hidden class=anchor aria-hidden=true href=#customer-managed>#</a></h3><p>Useful for sharing commonly used CIDR blocks in a customer&rsquo;s environment.</p><h1 id=security-groups>Security Groups<a hidden class=anchor aria-hidden=true href=#security-groups>#</a></h1><h1 id=endpoints>Endpoints<a hidden class=anchor aria-hidden=true href=#endpoints>#</a></h1><p>VPC endpoints are virtual devices enabling connectivity for compute or services within a VPC.</p><h2 id=types-1>Types<a hidden class=anchor aria-hidden=true href=#types-1>#</a></h2><h3 id=interface>Interface<a hidden class=anchor aria-hidden=true href=#interface>#</a></h3><p>Collection of managed ENIs with private IP to access AWS services (except dynamodb, s3), custom services, services from marketplace privately.</p><h3 id=gateway-load-balancer>Gateway Load Balancer<a hidden class=anchor aria-hidden=true href=#gateway-load-balancer>#</a></h3><p>Route traffic to a fleet of virtual appliances using private IPs.</p><h3 id=gateway>Gateway<a hidden class=anchor aria-hidden=true href=#gateway>#</a></h3><p>Targets specific IP routes <a href=/notes/aws/vpc/#prefix-lists>Prefix Lists</a> for traffic destined for <a href=/notes/aws/dynamodb/>AWS DynamoDB</a> and <a href=/notes/aws/s3/>AWS S3</a></p><h1 id=ingress-routing>Ingress Routing<a hidden class=anchor aria-hidden=true href=#ingress-routing>#</a></h1><p><img loading=lazy src=https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2020/03/19/Slide2-1.png alt=image></p><p>Here, the custom route table attached to the [[internet-gateway|AWS Internet Gateway]] forwards all incoming traffic to the network interface (<code>eni0</code>) of an EC2 instance. This instance could be running a security appliance like <a href=/notes/aws/network-firewall/>network-firewall</a> to inspect the traffic.</p><p>Similarly, the route table for application subnet has a route which forwards all internet bound traffic to the instance&rsquo;s network interface. Note: The appliance doesn&rsquo;t do any NAT, so the internet communication is based on the public IP of the workload instance.</p><h1 id=how-to-distribute-workloads-in-vpcs>How to distribute workloads in VPCs?<a hidden class=anchor aria-hidden=true href=#how-to-distribute-workloads-in-vpcs>#</a></h1><p>There are multiple ways to distribute workloads across different VPCs. Each approach has it&rsquo;s pros and cons, so they should be evaluated based on the customer&rsquo;s specific requirements.</p><ol><li>Based on Environment (dev, prod, shared services).</li><li>Based on Compliance needs like public facing services, internal only, PCI compliant resources etc.</li><li>Based on data sovernity restrictions (US, EU etc.) - across different regions.</li><li>Based on company structure, these can be seggregated further into their own specific accounts for each company division and so on.</li></ol><h1 id=vpc-to-vpc-connectivity>VPC to VPC Connectivity<a hidden class=anchor aria-hidden=true href=#vpc-to-vpc-connectivity>#</a></h1><p>As the number of VPCs increase in a customer&rsquo;s environment, the next obvious question that arises is, how to maintain connectivity between different VPCs, between VPCs and on-prem systems etc.</p><p>There are 2 broad approaches to establishing such connections. They are -</p><ol><li>Point to point - Traffic flows between specific VPCs.</li><li>Hub and spoke - Traffic flows via a central resource based on certain defined rules.</li></ol><h1 id=vpc-peering>VPC Peering<a hidden class=anchor aria-hidden=true href=#vpc-peering>#</a></h1><p>Point to point connectivity model.</p><p>This is a point to point connectivity method in which 2 VPCs are connected directly. It allows bidirectional traffic to flow between them. It does not support transitive connectivity.</p><p>VPC A peered with VPC B, and VPC B peered with VPC C. Traffic from VPC A cannot reach VPC C via B. To enable connectivity between A & C, a new peering connection must be estabished.</p><p>Maximum limit of 125 peering connections per VPC, so this does not scale very well.</p><p>Lowest cost for connecting VPCs since the charges are only for the traffic passing through the connection, there is no standing cost.</p><p>When using a <a href=/>VPN</a>, or [[direct-connect|Direct Connect]], each VPC must be connected individually to the DC or VPN. Peering does not support transitive routing, remember?</p><p>Works cross-region, cross-account.</p><p>Best suited for VPCs less than 10.</p><p>Traffic isolation can be achieved using security groups on specific resources (or NACLs as well?).</p><h1 id=transit-gatewaytransit-gatewaymd><a href=/notes/aws/transit-gateway/>Transit Gateway</a><a hidden class=anchor aria-hidden=true href=#transit-gatewaytransit-gatewaymd>#</a></h1><p>A hub-and-spoke model using Transit Gateway. Cost implications.</p><h1 id=transit-vpc>Transit VPC<a hidden class=anchor aria-hidden=true href=#transit-vpc>#</a></h1><p>A hub-and-spoke model.</p><p>In this solution, a central VPC with customer managed software appliances is used to route traffic between various connected networks. All VPCs can connect to this central VPC to gain access to the connected network. This is similar to Transit Gateway solution but is managed by customer.</p><p>Transitive connectivity is provided by a VPN overlay network using <a href=/>BGP</a> <a href=/>IPSec</a>.</p><p>The central VPC contains EC2 instances running software appliances that route the traffic to their destination using the VPN overlay network.</p><p>Customers can use the same L7 Firewall, IDP, IPS products for their on-prem/cloud workloads if using a vendor provided product as the software appliance.</p><p>Not very high performance - limited throughput of 1.2 Gbps/VPN tunnel.</p><p>It brings in additional complexity, cost, administrative and performance challenges.</p><p><img loading=lazy src=https://docs.aws.amazon.com/images/whitepapers/latest/building-scalable-secure-multi-vpc-network-infrastructure/images/transit-vpc-virtual-appliances.png alt=transit-vpc></p><h1 id=private-linkaws-private-link>[[private-link|AWS Private Link]]<a hidden class=anchor aria-hidden=true href=#private-linkaws-private-link>#</a></h1><p>Access AWS services, 3rd party SAAS apps directly in your VPC without traversing the internet.</p><h1 id=vpc-lattice>VPC Lattice<a hidden class=anchor aria-hidden=true href=#vpc-lattice>#</a></h1><p>Abstracts away the network complexity for application developers.</p><p>It creates logical application network layer called service network which allows service to service communication across VPC, regions, accounts over <a href=/>HTTP/HTTPS</a>, or <a href=/>gRPC</a>. It operates on a data plane in the VPC using the link local address layer <code>169.254/16</code> <a href=/>RFC#3927</a>. This data plane is exposed via an endpoint within the VPC. Once a service network is associated with a VPC, services deployed within the VPC can discover other services made available by the service network.</p><p><img loading=lazy src=https://docs.aws.amazon.com/images/vpc-lattice/latest/ug/images/how-it-works.png alt=vpc-lattice-example></p><blockquote><p><strong>QUESTION</strong>
In the above diagram, while VPC1, 3 are associated with the service network, VPC2 isn&rsquo;t. <em>So what&rsquo;s the impact of this?</em>
All 3 services are associated with the service network meaning they are discoverable by resources running in VPCs associted with the service network i.e. resources in VPC1, 3. But, they aren&rsquo;t discoverable from VPC2. This means the service in VPC2 doesn&rsquo;t really depend on any other service and just responds to requests received.</p></blockquote><h2 id=service>Service<a hidden class=anchor aria-hidden=true href=#service>#</a></h2><p>An independent software unit that performs a specific function. While configuring a service with a service network, you use similar resources like a load balancer - listners, routing rules and target groups.</p><h2 id=service-directory>Service directory<a hidden class=anchor aria-hidden=true href=#service-directory>#</a></h2><p>Central directory (at account level) of registered services, either deployed in the same account or shared via <a href=/>AWS Resource Access Manager</a>.</p><h2 id=service-network>Service network<a hidden class=anchor aria-hidden=true href=#service-network>#</a></h2><p>Logical grouping of services to enable connectivity and apply common policies</p><h2 id=auth-policy>Auth Policy<a hidden class=anchor aria-hidden=true href=#auth-policy>#</a></h2><p>Resource policy to ensure only authenticated and authorized clients use the services</p><h1 id=vpc-sharing>VPC Sharing<a hidden class=anchor aria-hidden=true href=#vpc-sharing>#</a></h1><p>VPC and/or subnets can be shared across accounts in an Org using <a href=/>AWS Resource Access Manager</a>.</p><p>This is a low cost, low operational overhead solution, however, quite permissive in terms to network isolation.</p><p>Network isolation can be improved by using grouping apps by behaviour and using separate subnets with relevant NACL for each group. Further isolation can be achieved by using security groups.</p><h1 id=private-nat-gateway>Private NAT Gateway<a hidden class=anchor aria-hidden=true href=#private-nat-gateway>#</a></h1><p>Connect networks with overlapping CIDR blocks.</p><p><img loading=lazy src=https://d2908q01vomqb2.cloudfront.net/5b384ce32d8cdef02bc3a139d4cac0a22bb029e8/2021/08/31/Figure3-1.jpeg alt=private-nat-gateway></p><blockquote><p><strong>INFO</strong>
Here, the 2 VPCs have <em>non-routable</em> overlapping range of <code>100.64/16</code>. Based on secondary CIDR [[#Constraints| <a href=/notes/aws/vpc/#constraints>constraints</a>, select a non-overlapping <em>routable</em> CIDR block for both VPC.
VPC A = <code>10.0.1.0/24</code>, VPC B = <code>10.0.2.0/24</code>
Now, subnets are created within this secondary range in both VPCs - <code>10.0.1.0/25</code>, and <code>10.0.2.0/25</code>. These new subnets are used to launch private NAT gateways which will do the address translation. The new subnets are attached to the transit gateway with appropriate routes defined to refer to each other. In the non-routable sunets, routes are updated to send all non-local requests to the NAT.</p><ol><li>As per the VPC A non-routable subnet route table, the packet with destination of ALB IP (10.0.2.x) is headed to the private NAT in VPC A routable subnet.</li><li>Private NAT does the network translation, and forwards the packet to the TGW attachement as per the VPC A routable subnet route table.</li><li>As per the TGW route table, the packet is then forwarded to the ALB in VPC B routable subnets.</li><li>The ALB then forwards the packet to the destination in VPC B non-routable subnet.
Response follows a similar path back - 5, 6, 7, 8.</li></ol></blockquote><p><a href=https://aws.amazon.com/blogs/networking-and-content-delivery/how-to-solve-private-ip-exhaustion-with-private-nat-solution/>Reference</a></p><h1 id=vpc-peering-vs-transit-vpc-vs-transit-gateway>VPC peering vs. Transit VPC vs. Transit Gateway<a hidden class=anchor aria-hidden=true href=#vpc-peering-vs-transit-vpc-vs-transit-gateway>#</a></h1><p>Comparison of VPC peering, Transit VPC, and Transit Gateway</p><table><thead><tr><th>Criteria</th><th>VPC peering</th><th>Transit VPC</th><th>Transit Gateway</th></tr></thead><tbody><tr><td>Architecture</td><td>Full mesh</td><td>VPN-based hub-and-spoke</td><td>Attachments-based hub-and-spoke. Can be peered with other TGWs.</td></tr><tr><td>Complexity</td><td>Increases with VPC count</td><td>Customer needs to maintain EC2 instance/HA</td><td>AWS-managed service; increases with Transit Gateway count</td></tr><tr><td>Scale</td><td>125 active Peers/VPC</td><td>Depends on virtual router/EC2</td><td>5000 attachments per Region</td></tr><tr><td>Segmentation</td><td>Security groups</td><td>Customer managed</td><td>Transit Gateway route tables</td></tr><tr><td>Latency</td><td>Lowest</td><td>Extra, due to VPN encryption overhead</td><td>Additional Transit Gateway hop</td></tr><tr><td>Bandwidth limit</td><td>No limit</td><td>Subject to EC2 instance bandwidth limits based on size/family</td><td>Up to 50 Gbps (burst)/attachment</td></tr><tr><td>Visibility</td><td>VPC Flow Logs</td><td>VPC Flow Logs and CloudWatch Metrics</td><td>Transit Gateway Network Manager, VPC Flow Logs, CloudWatch Metrics</td></tr><tr><td>Security group cross-referencing</td><td>Supported</td><td>Not supported</td><td>Not supported</td></tr><tr><td>Cost</td><td>Data transfer</td><td>EC2 hourly cost, VPN tunnels cost and data transfer</td><td>Hourly per attachment, data processing, and data transfer</td></tr></tbody></table><h1 id=hybrid-connectivity>Hybrid Connectivity<a hidden class=anchor aria-hidden=true href=#hybrid-connectivity>#</a></h1><p>There are 2 approaches to establish hybrid connectivity. Both utilize VPN, but differ in where and how the VPN connection terminates.</p><h2 id=one-to-one>One to One<a hidden class=anchor aria-hidden=true href=#one-to-one>#</a></h2><p>In this case, each VPC is connected to the VPN individually using Direct Connect/Virtual Private Gateway.</p><h2 id=edge-consolidation>Edge Consolidation<a hidden class=anchor aria-hidden=true href=#edge-consolidation>#</a></h2><p>Connect the VPN to a central <a href=/notes/aws/transit-gateway/>transit-gateway</a> and then attach VPCs to this central Transit Gateway.</p><p>Once the approach is decided, there are 4 different ways to terminate VPN connection on AWS</p><h2 id=transit-gateway>Transit Gateway<a hidden class=anchor aria-hidden=true href=#transit-gateway>#</a></h2><p>Recommended <a href=/notes/aws/transit-gateway/#vpn>option</a>, to connect VPN to a central Transit Gateway.
Cost = AWS Transit Gateway Pricing + AWS VPN pricing.</p><h2 id=ec2>EC2<a hidden class=anchor aria-hidden=true href=#ec2>#</a></h2><p>Some customers might want to use 3rd party software products, so terminating the VPN on an EC2 instance is also an option. This is basically one to one connectivity.</p><p>To enable Edge consolidation, you can use the [[#Transit VPC]] pattern. However, the same drawbacks as highlighted in that section remain.</p><p>This is also an option when wanting to use <a href=/>GRE</a>.</p><h2 id=virtual-private-gateway-vgw>Virtual Private Gateway VGW<a hidden class=anchor aria-hidden=true href=#virtual-private-gateway-vgw>#</a></h2><p>Great option when starting out, since this is a [[#One to One]] connectivity design where you need to configure this on a per VPC basis.</p><p>Offers redundancy due to 2 tunnels/connection design.</p><p>Does not support <a href=/>ECMP</a> for VPN connections so throughput is limited to 1.25 Gbps per tunnel.</p><p>Cost = AWS VPN pricing only, no charge for Virtual Private Gateway</p><blockquote><p><strong>Question</strong>
How are Virtual Private Gateway and Customer Gateways related?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>on-prem ------ aws customer ------ aws virtual
</span></span><span style=display:flex><span>device  ------ gateway      ------ private gw ---- aws vpc
</span></span><span style=display:flex><span>|&lt;--------- site to site VPN connection ---------&gt;
</span></span></code></pre></div></blockquote><blockquote><p><strong>Question</strong>
How are Virtual Private Gateway and Direct Connect related?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>on-prem ---- direct ---- virtual --- aws virtual
</span></span><span style=display:flex><span>device ---- connect ---- interface --- private gw --- aws vpc
</span></span></code></pre></div></blockquote><h2 id=client-vpn-endpoint>Client VPN Endpoint<a hidden class=anchor aria-hidden=true href=#client-vpn-endpoint>#</a></h2><p>Another option when starting out. This is a <a href=/notes/aws/vpc/#one-to-one>One to One</a> connectivity design where you need to configure this on a per VPC basis, or make use of other VPC connectivity features to achieve an <a href=/notes/aws/vpc/#edge-consolidation>Edge Consolidation</a> connectivity design.</p><p><img loading=lazy src=https://docs.aws.amazon.com/images/vpn/latest/clientvpn-admin/images/architecture.png alt=client-vpn-endpoint></p><p>To configure client VPN endpoint, you need -</p><ol><li>Target Network - subnets in a VPC, 1 per AZ.</li><li>Additional routes - local, to peered VPC or VPGW etc.</li><li>Authentication Mechanism<ol><li>SAML 2.0 (Single IdP only)</li><li>Mutual authentication, cert based - each client needs a new cert</li><li>Active Directory</li></ol></li><li>Client CIDR block between <code>/12</code> and <code>/22</code> prefix/subnet mask.</li><li>Server certificate in [[AWS Certificate Manager]] regardless of authentication mechanism selected</li><li>Enable self service portal (optional)</li><li>Enable split tunnel (optional)</li></ol><p>Once configured, download the client VPN configuration file, and use it to connect to the VPN endpoint. This file contains info like the DNS name of the VPN endpoint, authorization mechanism, client CIDR blocks to use etc.</p><h2 id=authorization>Authorization<a hidden class=anchor aria-hidden=true href=#authorization>#</a></h2><p>Security groups (attached to the client VPN endpoint) and network based authorization rules using either AD attributes or IdP provided metadat like groups etc.</p><h2 id=split-tunnel>Split Tunnel<a hidden class=anchor aria-hidden=true href=#split-tunnel>#</a></h2><p>Use this to send <em>specific</em> traffic to the AWS tunnel. By default, the client endpoint route adds a <code>0.0.0.0</code> route to the client which sends <em>all</em> traffic from the client machine to the AWS tunnel. This can increase data transfer costs if everything goes via AWS.</p><p>Split tunnel adds specific routes to the client device route table which ensures only the traffic destined for AWS is sent over the tunnel. When using split tunnel ensure to not have a <code>0.0.0.0</code> route in the client VPN, otherwise it will still send traffic not destined for AWS to the tunnel.</p><h1 id=direct-connectdirect-connectmd><a href=/notes/aws/direct-connect/>Direct Connect</a><a hidden class=anchor aria-hidden=true href=#direct-connectdirect-connectmd>#</a></h1><p>Connect On-prem network to AWS backbone network.</p><h1 id=limits>Limits<a hidden class=anchor aria-hidden=true href=#limits>#</a></h1><p>250 network interfaces per VPC.</p><h1 id=references>References<a hidden class=anchor aria-hidden=true href=#references>#</a></h1><ul><li><a href=https://aws.amazon.com/blogs/aws/new-vpc-ingress-routing-simplifying-integration-of-third-party-appliances/>https://aws.amazon.com/blogs/aws/new-vpc-ingress-routing-simplifying-integration-of-third-party-appliances/</a></li><li><a href=https://aws.amazon.com/blogs/containers/eks-vpc-routable-ip-address-conservation/>https://aws.amazon.com/blogs/containers/eks-vpc-routable-ip-address-conservation/</a></li><li><a href=https://aws.amazon.com/blogs/networking-and-content-delivery/designing-hyperscale-amazon-vpc-networks/>https://aws.amazon.com/blogs/networking-and-content-delivery/designing-hyperscale-amazon-vpc-networks/</a></li><li><a href=https://aws.amazon.com/blogs/networking-and-content-delivery/how-to-solve-private-ip-exhaustion-with-private-nat-solution/>https://aws.amazon.com/blogs/networking-and-content-delivery/how-to-solve-private-ip-exhaustion-with-private-nat-solution/</a></li><li><a href=https://docs.aws.amazon.com/vpc/latest/tgw/transit-gateway-appliance-scenario.html>https://docs.aws.amazon.com/vpc/latest/tgw/transit-gateway-appliance-scenario.html</a></li><li><a href=https://docs.aws.amazon.com/vpc/latest/tgw/transit-gateway-nat-igw.html>https://docs.aws.amazon.com/vpc/latest/tgw/transit-gateway-nat-igw.html</a></li><li><a href=https://docs.aws.amazon.com/vpc/latest/userguide/VPC_Route_Tables.html#gateway-route-table>https://docs.aws.amazon.com/vpc/latest/userguide/VPC_Route_Tables.html#gateway-route-table</a></li><li><a href=https://repost.aws/knowledge-center/vpc-analyze-inbound-traffic-nat-gateway>https://repost.aws/knowledge-center/vpc-analyze-inbound-traffic-nat-gateway</a></li></ul></div><footer class=post-footer><hr><div class=align-center><div class=slimlist-entry><h2>Topics</h2></div><ul class=post-tags><div class=slimlist-entry><li class=post-tags><a href=https://abiydv.github.io/topics/aws/>aws</a></li><li class=post-tags><a href=https://abiydv.github.io/topics/stage-incubating/>stage/incubating</a></li><li class=post-tags><a href=https://abiydv.github.io/topics/network/>network</a></li></div></ul></div></footer><script src=https://utteranc.es/client.js repo=abiydv/abiydv.github.io issue-term=title label=Comment theme=github-light crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2019-2025 <a href=https://abiydv.github.io/>@abiydv</a> / </span><span>Published 4.4.25 /
</span><span>Thanks <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a>, <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script></body></html>