<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Service Control Policies and BDD | @abiydv</title>
<meta name=keywords content="aws,bdd,go"><meta name=description content="Deploy AWS service control policies reliably using BDD tests"><meta name=author content><link rel=canonical href=https://abiydv.github.io/posts/aws-scp-test-bdd/><link crossorigin=anonymous href=/assets/css/stylesheet.c5edd088d0c984c192170cfbab7d2de030010ee0b7d771bd6bca049dd2332874.css integrity="sha256-xe3QiNDJhMGSFwz7q30t4DABDuC313G9a8oEndIzKHQ=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://abiydv.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://abiydv.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://abiydv.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://abiydv.github.io/apple-touch-icon.png><link rel=mask-icon href=https://abiydv.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://abiydv.github.io/posts/aws-scp-test-bdd/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="Service Control Policies and BDD"><meta property="og:description" content="Deploy AWS service control policies reliably using BDD tests"><meta property="og:type" content="article"><meta property="og:url" content="https://abiydv.github.io/posts/aws-scp-test-bdd/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-06-28T00:00:00+00:00"><meta property="article:modified_time" content="2024-06-28T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Service Control Policies and BDD"><meta name=twitter:description content="Deploy AWS service control policies reliably using BDD tests"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://abiydv.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Service Control Policies and BDD","item":"https://abiydv.github.io/posts/aws-scp-test-bdd/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Service Control Policies and BDD","name":"Service Control Policies and BDD","description":"Deploy AWS service control policies reliably using BDD tests","keywords":["aws","bdd","go"],"articleBody":"Introduction Service control policies(SCPs) are a type of organization policy that you can use to centrally manage maximum available permissions for the IAM users and IAM roles in your organization. Since they are usually applied over a group of accounts, it is best practice to test changes in a sandbox environment/account. SCPs are often used to restrict actions as per standards applied by a company.\nBehaviour-Driven Development(BDD) is a test driven software development philosophy. TDD generally involves writing tests before actually writing code. In BDD, tests are written using natural language to validate the expected outcome of a system. Domain specific language using natural language constructs, makes it easy to read for software developers and business users alike.\nI had previously written about using BDD to make reliable deployments to Fastly. In this post, we will use BDD to reliably deploy Organization policies (service control and tag policies) to an entire AWS Organization or group of AWS accounts.\nProblem With growing complexity in AWS environments, SCPs are becoming increasingly important for organizations to apply guardrails, to ensure all member accounts adhere to best practices and established standards. As they are applied on a group of accounts at a time, any unintended side-effect due to a change can have massive impact. This makes testing, a crucial part of deploying any SCPs. AWS recommends testing these policies thoroughly in a sandbox environment before applying them to live accounts.\nRunning a suite of tests for every change in the policy, however minor, can be a time consuming process, if done manually. While it may be easy to verify the changes manually when the policies are short, it does not scale well as the size (and complexity) of these policies increases.\nExample Let’s consider the following requirements -\nEnsure all instances have 3 tags - dept, cost and proj. cost tag value is one of 001,002 or 003. Block any EC2 from using a public IP unless it has a tag exempt: public-ip-control In the next few sections, we will develop tests, and the policies to achieve this goal.\nSolution BDD tests (or specifications) are written in plain-text and use basic syntax rules called Gherkin. Cucumber reads and executes these specs, and validates the outcome is as expected.\nTest Scenarios For the example requirements (1,2) defined above, let’s write a basic feature test with some scenarios.\nFeature: EC2 instances must have basic tags Scenario: Block ec2 with no tags Given I want to launch 1 ec2 instance And use subnet \"private-subnet-1\" in vpc \"my-vpc\" And add tags: | key | value | add_to_resources | When I launch the ec2 instance Then the response is \"UnauthorizedOperation\" Scenario: Allow ec2 with basic tags Given I want to launch 1 ec2 instance And use subnet \"private-subnet-1\" in vpc \"my-vpc\" And add tags: | key | value | add_to_resources | | Name | first | instance, network-interface, volume | | dept | blue | instance, network-interface, volume | | cost | 001 | instance, network-interface, volume | | proj | one | instance, network-interface, volume | When I launch the ec2 instance Then the response is \"OK\" The first scenario checks if you don’t specify any tags, you are unable to launch an instance. The second scenario checks if you do specify the basic tags you are to launch the instance just fine. Full feature files are here.\nTest Specifications After the tests, we need to write an implementation of these scenarios, which will make AWS API calls to validate the behaviour.\nIn this example, we use godog, the official Cucumber BDD framework for Golang. It merges specification and test documentation into one cohesive whole, using Gherkin formatted scenarios. Their example section also provides an easy to follow quickstart guide.\ngodog helpfully creates the scaffolding around your tests, so you can easily fill in the gaps. Create a minimal go module like below, and execute go test to get the initial scaffolding.\n// ec2_test.go package main import ( \"testing\" \"github.com/cucumber/godog\" ) func InitializeScenario(ctx *godog.ScenarioContext) {} func TestFeatures(t *testing.T) { suite := godog.TestSuite{ ScenarioInitializer: InitializeScenario, Options: \u0026godog.Options{ Format: \"pretty\", Paths: []string{\"features\"}, TestingT: t, // Testing instance that will run subtests. }, } if suite.Run() != 0 { t.Fatal(\"non-zero status returned, failed to run feature tests\") } } For reference, full specifications are here.\nDevelop Organization Policies With our tests in place, we can now create the policies to meet the requirements. For the example problem statements defined above, we need to use both, a service control and tag policy. Example policies are here.\nExecute Tests Once you are happy with the specifications, you can run through the scenarios same way as you would execute go tests - go test. Remember to provide AWS credentials as explained here. The easist method, while testing, is to simply export the credentials as environment variables. Best to use a sandbox environment during the testing phase.\nIt’s good to execute these tests before applying any organization policy to establish a baseline and tweak the tests accordingly. Depending on the state your sandbox environment (and permissions), there is a possiblity that some of the negative tests might succeed. This is because, missing IAM permissions will also result in the AWS API returning an error. Therefore, it’s important to distinguish between the type of error. See this function, which checks for different types of errors. This function fails the test if it encounters a permission error.\nAfter an initial test, deploy the organization policies to a sandbox environment via your usual method. Execute these tests again post deployment, to validate whether the policy is working as expected. If not, tweak the policy as necessary. This is an iterative process - you will need to repeat these steps a few times to get the desired result.\nContinous Integration Test runs can (rather, should) be incorporated into your continuous integration pipeline, to run as part of pull-request checks. This will ensure changes do not have any unintended consequences. Once reviewed, and approved, a pull-request merge can trigger deployment of the polcies across larger groups of AWS accounts, or even the entire AWS Organization.\nTo take it a step further, you can even run these tests parallely against all accounts the policies are applied to. If these fail for any reason, trigger a rollback.\nSource Code You can refer to this repo which contains a complete working example - a service control, and tag policy, as well as some BDD tests. It does not contain the continous integration pipeline, to deploy the policies or run the tests. But, it should be relatively straight forward to configure one, based on the steps, we have already discussed in the previous sections.\nCaveats As with most solutions, this isn’t a silver bullet, but rather a starting point to make changes more reliable and predictable. It’s good to be mindful of the following caveats when working with this pattern.\nTests can succeed or fail due to lack of permissions. Ensure you do baseline tests on existing infrastructure, as well as distinguish between different errors that can be returned by AWS API. For example, here is a list of errors returned by the EC2 API. This example uses DryRun flag available for RunInstances action. This may not be the case for every resource. If this isn’t available, tests will have to create actual resources, and that means managing the whole lifecycle of such resources. Tests need AWS account credentials, which will need to be setup in every account you want to run the tests in. In light of the above caveats, it may not always be possible to encode and automate such tests to cover the service control or tag policy in their entirety. There might be an element of manual testing that is still required.\nClosing Thoughts Service control (and tag) policies are a great way to establish guardrails across an AWS Oganization and drive best practices. However, it is essential to test the changes before deploying them to live accounts. Introducing a BDD methodology helps make these changes more reliable, predictable and less likely to have unintended side effects.\nHope this post has given you some ideas on how to adapt this into your own environment. Please comment below if you want to add something or have any questions.\nReferences (6) Handling Errors Orgs Manage Policies #What Is Gherkin #What Is Cucumber Godog Aws Scp Bdd ","wordCount":"1394","inLanguage":"en","datePublished":"2024-06-28T00:00:00Z","dateModified":"2024-06-28T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://abiydv.github.io/posts/aws-scp-test-bdd/"},"publisher":{"@type":"Organization","name":"@abiydv","logo":{"@type":"ImageObject","url":"https://abiydv.github.io/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://abiydv.github.io/ accesskey=h title="@abiydv (Alt + H)">@abiydv</a><div class=logo-switches></div></div><ul id=menu><li><a href=https://abiydv.github.io/ title=Home><span>Home</span></a></li><li><a href=https://abiydv.github.io/about/ title=About><span>About</span></a></li><li><a href=https://abiydv.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://abiydv.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://abiydv.github.io/notes/ title=Notes><span>Notes</span></a></li><li><a href=https://abiydv.github.io/search title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://abiydv.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://abiydv.github.io/posts/>Posts</a></div><h1 class=post-title>Service Control Policies and BDD</h1><div class=post-description>Deploy AWS service control policies reliably using BDD tests</div><div class=post-meta>28.6.24 / Posts / 7 min</div></header><div class=post-content><h2 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h2><p><a href=https://docs.aws.amazon.com/organizations/latest/userguide/orgs_manage_policies_scps.html>Service control policies(SCPs)</a> are a type of organization policy that you can use to centrally manage maximum available permissions for the IAM users and IAM roles in your organization. Since they are usually applied over a group of accounts, it is best practice to test changes in a sandbox environment/account. SCPs are often used to restrict actions as per standards applied by a company.</p><p><a href=https://en.wikipedia.org/wiki/Behavior-driven_development>Behaviour-Driven Development(BDD)</a> is a test driven software development philosophy. TDD generally involves writing tests before actually writing code. In BDD, tests are written using natural language to validate the expected outcome of a system. Domain specific language using natural language constructs, makes it easy to read for software developers and business users alike.</p><p>I had <a href=https://abiydv.github.io/posts/fastly-bdd/>previously written</a> about using BDD to make reliable deployments to Fastly. In this post, we will use BDD to reliably deploy Organization policies (service control and tag policies) to an entire AWS Organization or group of AWS accounts.</p><h2 id=problem>Problem<a hidden class=anchor aria-hidden=true href=#problem>#</a></h2><p>With growing complexity in AWS environments, SCPs are becoming increasingly important for organizations to apply guardrails, to ensure all member accounts adhere to best practices and established standards. As they are applied on a group of accounts at a time, any unintended side-effect due to a change can have massive impact. This makes testing, a crucial part of deploying any SCPs. <a href=https://docs.aws.amazon.com/organizations/latest/userguide/orgs_manage_policies_scps.html>AWS recommends</a> testing these policies thoroughly in a sandbox environment before applying them to live accounts.</p><p>Running a suite of tests for every change in the policy, however minor, can be a time consuming process, if done manually. While it may be easy to verify the changes manually when the policies are short, it does not scale well as the size (and complexity) of these policies increases.</p><h3 id=example>Example<a hidden class=anchor aria-hidden=true href=#example>#</a></h3><p>Let&rsquo;s consider the following requirements -</p><ol><li>Ensure all instances have 3 tags - <code>dept</code>, <code>cost</code> and <code>proj</code>.</li><li><code>cost</code> tag value is one of <code>001</code>,<code>002</code> or <code>003</code>.</li><li>Block any EC2 from using a public IP unless it has a tag <code>exempt: public-ip-control</code></li></ol><p>In the next few sections, we will develop tests, and the policies to achieve this goal.</p><h2 id=solution>Solution<a hidden class=anchor aria-hidden=true href=#solution>#</a></h2><p>BDD tests (or specifications) are written in plain-text and use basic syntax rules called <a href=https://cucumber.io/docs/guides/overview/#what-is-gherkin>Gherkin</a>. <a href=https://cucumber.io/docs/guides/overview/#what-is-cucumber>Cucumber</a> reads and executes these specs, and validates the outcome is as expected.</p><h3 id=test-scenarios>Test Scenarios<a hidden class=anchor aria-hidden=true href=#test-scenarios>#</a></h3><p>For the example requirements (1,2) defined above, let&rsquo;s write a basic feature test with some scenarios.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Feature: EC2 instances must have basic tags
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  Scenario: Block ec2 with no tags
</span></span><span style=display:flex><span>    Given I want to launch 1 ec2 instance 
</span></span><span style=display:flex><span>    And use subnet &#34;private-subnet-1&#34; in vpc &#34;my-vpc&#34;
</span></span><span style=display:flex><span>    And add tags:
</span></span><span style=display:flex><span>        | key | value | add_to_resources |
</span></span><span style=display:flex><span>    When I launch the ec2 instance
</span></span><span style=display:flex><span>    Then the response is &#34;UnauthorizedOperation&#34;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  Scenario: Allow ec2 with basic tags
</span></span><span style=display:flex><span>    Given I want to launch 1 ec2 instance
</span></span><span style=display:flex><span>    And use subnet &#34;private-subnet-1&#34; in vpc &#34;my-vpc&#34;
</span></span><span style=display:flex><span>    And add tags:
</span></span><span style=display:flex><span>        | key  | value | add_to_resources |
</span></span><span style=display:flex><span>        | Name | first | instance, network-interface, volume |
</span></span><span style=display:flex><span>        | dept | blue  | instance, network-interface, volume |
</span></span><span style=display:flex><span>        | cost | 001   | instance, network-interface, volume |
</span></span><span style=display:flex><span>        | proj | one   | instance, network-interface, volume |
</span></span><span style=display:flex><span>    When I launch the ec2 instance
</span></span><span style=display:flex><span>    Then the response is &#34;OK&#34;
</span></span></code></pre></div><p>The first scenario checks if you don&rsquo;t specify any tags, you are unable to launch an instance. The second scenario checks if you do specify the basic tags you are to launch the instance just fine. Full feature files are <a href=https://github.com/abiydv/aws-scp-bdd/tree/main/features>here</a>.</p><h3 id=test-specifications>Test Specifications<a hidden class=anchor aria-hidden=true href=#test-specifications>#</a></h3><p>After the tests, we need to write an implementation of these scenarios, which will make AWS API calls to validate the behaviour.</p><p>In this example, we use <a href=https://github.com/cucumber/godog/tree/v0.14.0>godog</a>, the official Cucumber BDD framework for Golang. It merges specification and test documentation into one cohesive whole, using Gherkin formatted scenarios. Their <a href="https://github.com/cucumber/godog/tree/v0.14.0?tab=readme-ov-file#examples">example</a> section also provides an easy to follow quickstart guide.</p><p><a href=https://github.com/cucumber/godog/tree/v0.14.0>godog</a> helpfully creates the scaffolding around your tests, so you can easily fill in the gaps. Create a minimal go module like below, and execute <code>go test</code> to get the initial scaffolding.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// ec2_test.go
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;testing&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;github.com/cucumber/godog&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>InitializeScenario</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>godog</span>.<span style=color:#a6e22e>ScenarioContext</span>) {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestFeatures</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>suite</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>godog</span>.<span style=color:#a6e22e>TestSuite</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>ScenarioInitializer</span>: <span style=color:#a6e22e>InitializeScenario</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Options</span>: <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>godog</span>.<span style=color:#a6e22e>Options</span>{
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>Format</span>:   <span style=color:#e6db74>&#34;pretty&#34;</span>,
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>Paths</span>:    []<span style=color:#66d9ef>string</span>{<span style=color:#e6db74>&#34;features&#34;</span>},
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>TestingT</span>: <span style=color:#a6e22e>t</span>, <span style=color:#75715e>// Testing instance that will run subtests.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		},
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>suite</span>.<span style=color:#a6e22e>Run</span>() <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#e6db74>&#34;non-zero status returned, failed to run feature tests&#34;</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>For reference, full specifications are <a href=https://github.com/abiydv/aws-scp-bdd>here</a>.</p><h3 id=develop-organization-policies>Develop Organization Policies<a hidden class=anchor aria-hidden=true href=#develop-organization-policies>#</a></h3><p>With our tests in place, we can now create the policies to meet the requirements. For the example problem statements defined above, we need to use both, a service control and tag policy. Example policies are <a href=https://github.com/abiydv/aws-scp-bdd/tree/main/policies>here</a>.</p><h3 id=execute-tests>Execute Tests<a hidden class=anchor aria-hidden=true href=#execute-tests>#</a></h3><p>Once you are happy with the specifications, you can run through the scenarios same way as you would execute go tests - <code>go test</code>. Remember to provide AWS credentials as explained <a href=https://aws.github.io/aws-sdk-go-v2/docs/configuring-sdk/>here</a>. The easist method, while testing, is to simply export the credentials as environment variables. Best to use a sandbox environment during the testing phase.</p><p>It&rsquo;s good to execute these tests before applying any organization policy to establish a baseline and tweak the tests accordingly. Depending on the state your sandbox environment (and permissions), there is a possiblity that some of the <em>negative</em> tests might succeed. This is because, missing IAM permissions will also result in the AWS API returning an error. Therefore, it&rsquo;s important to distinguish between the <em>type</em> of error. See this <a href=https://github.com/abiydv/aws-scp-bdd/blob/main/ec2_test.go#L129>function</a>, which checks for different <em>types</em> of errors. This function fails the test if it encounters a permission error.</p><p>After an initial test, deploy the organization policies to a sandbox environment via your usual method. Execute these tests again post deployment, to validate whether the policy is working as expected. If not, tweak the policy as necessary. This is an iterative process - you will need to repeat these steps a few times to get the desired result.</p><h3 id=continous-integration>Continous Integration<a hidden class=anchor aria-hidden=true href=#continous-integration>#</a></h3><p>Test runs can (rather, should) be incorporated into your continuous integration pipeline, to run as part of pull-request checks. This will ensure changes do not have any unintended consequences. Once reviewed, and approved, a pull-request merge can trigger deployment of the polcies across larger groups of AWS accounts, or even the entire AWS Organization.</p><p>To take it a step further, you can even run these tests parallely against all accounts the policies are applied to. If these fail for any reason, trigger a rollback.</p><h2 id=source-code>Source Code<a hidden class=anchor aria-hidden=true href=#source-code>#</a></h2><p>You can refer to <a href=https://github.com/abiydv/aws-scp-bdd>this repo</a> which contains a complete working example - a service control, and tag policy, as well as some BDD tests. It does <em>not</em> contain the continous integration pipeline, to deploy the policies or run the tests. But, it should be relatively straight forward to configure one, based on the steps, we have already discussed in the previous sections.</p><h2 id=caveats>Caveats<a hidden class=anchor aria-hidden=true href=#caveats>#</a></h2><p>As with most solutions, this isn&rsquo;t a silver bullet, but rather a starting point to make changes more reliable and predictable. It&rsquo;s good to be mindful of the following caveats when working with this pattern.</p><ul><li>Tests can succeed or fail due to lack of permissions. Ensure you do baseline tests on existing infrastructure, as well as distinguish between different errors that can be returned by AWS API. For example, here is a <a href=https://docs.aws.amazon.com/AWSEC2/latest/APIReference/errors-overview.html>list of errors</a> returned by the EC2 API.</li><li>This example uses <code>DryRun</code> flag available for <a href=https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_RunInstances.html>RunInstances</a> action. This may not be the case for every resource. If this isn&rsquo;t available, tests will have to create actual resources, and that means managing the whole lifecycle of such resources.</li><li>Tests need AWS account credentials, which will need to be setup in every account you want to run the tests in.</li></ul><p>In light of the above caveats, it may not always be possible to encode and automate such tests to cover the service control or tag policy in their entirety. There might be an element of manual testing that is still required.</p><h2 id=closing-thoughts>Closing Thoughts<a hidden class=anchor aria-hidden=true href=#closing-thoughts>#</a></h2><p>Service control (and tag) policies are a great way to establish guardrails across an AWS Oganization and drive best practices. However, it is essential to test the changes before deploying them to live accounts. Introducing a BDD methodology helps make these changes more reliable, predictable and less likely to have unintended side effects.</p><p>Hope this post has given you some ideas on how to adapt this into your own environment. Please comment below if you want to add something or have any questions.</p><h2>References (6)</h2><ol class=slimlist-ol><li class=slimlist-ol><a aria-label="link to https://aws.github.io/aws-sdk-go-v2/docs/handling-errors" target=_blank href=https://aws.github.io/aws-sdk-go-v2/docs/handling-errors>Handling Errors&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li class=slimlist-ol><a aria-label="link to https://docs.aws.amazon.com/organizations/latest/userguide/orgs_manage_policies.html" target=_blank href=https://docs.aws.amazon.com/organizations/latest/userguide/orgs_manage_policies.html>Orgs Manage Policies&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li class=slimlist-ol><a aria-label="link to https://cucumber.io/docs/guides/overview/#what-is-gherkin" target=_blank href=https://cucumber.io/docs/guides/overview/#what-is-gherkin>#What Is Gherkin&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li class=slimlist-ol><a aria-label="link to https://cucumber.io/docs/guides/overview/#what-is-cucumber" target=_blank href=https://cucumber.io/docs/guides/overview/#what-is-cucumber>#What Is Cucumber&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li class=slimlist-ol><a aria-label="link to https://github.com/cucumber/godog" target=_blank href=https://github.com/cucumber/godog>Godog&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li class=slimlist-ol><a aria-label="link to https://github.com/abiydv/aws-scp-bdd" target=_blank href=https://github.com/abiydv/aws-scp-bdd>Aws Scp Bdd&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ol></div><footer class=post-footer><hr><div class=align-center><div class=slimlist-entry><h2>Tags</h2></div><ul class=post-tags><div class=slimlist-entry><li class=post-tags><a href=https://abiydv.github.io/tags/aws/>aws</a></li><li class=post-tags><a href=https://abiydv.github.io/tags/bdd/>bdd</a></li><li class=post-tags><a href=https://abiydv.github.io/tags/go/>go</a></li></div></ul></div></footer><script src=https://utteranc.es/client.js repo=abiydv/abiydv.github.io issue-term=title label=Comment theme=github-light crossorigin=anonymous async></script><hr><div class=align-left><div class=slimlist-entry><h2>Related</h2></div><ul class=slimlist><li class=slimlist><div class=slimlist-entry><h3 class=slimlist-entry-title><a aria-label="post link to AWS EKS Okta Auth" href=https://abiydv.github.io/posts/aws-eks-okta-auth/>AWS EKS Okta Auth</a></h3><div class=slimlist-meta>24.6.23 / Posts / 3 min</div></div></li><li class=slimlist><div class=slimlist-entry><h3 class=slimlist-entry-title><a aria-label="post link to Terraform, multi-account and multi-region workloads" href=https://abiydv.github.io/posts/terraform-multiaccount-multiregion/>Terraform, multi-account and multi-region workloads</a></h3><div class=slimlist-meta>25.5.22 / Posts / 5 min</div></div></li><li class=slimlist><div class=slimlist-entry><h3 class=slimlist-entry-title><a aria-label="post link to Terraform, Bitbucket pipelines and OIDC" href=https://abiydv.github.io/posts/terraform-bitbucket-pipeline-oidc/>Terraform, Bitbucket pipelines and OIDC</a></h3><div class=slimlist-meta>30.9.21 / Posts / 7 min</div></div></li></ul></div></article></main><footer class=footer><span>&copy; 2019-2025 <a href=https://abiydv.github.io/>@abiydv</a> / </span><span>Published 4.4.25 /
</span><span>Thanks <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a>, <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script></body></html>