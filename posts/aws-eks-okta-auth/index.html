<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>AWS EKS Okta Auth | @abiydv</title>
<meta name=keywords content="aws,eks,kubernetes,idp,okta"><meta name=description content="Authenticate to AWS EKS with Okta"><meta name=author content><link rel=canonical href=https://abiydv.github.io/posts/aws-eks-okta-auth/><link crossorigin=anonymous href=/assets/css/stylesheet.c5edd088d0c984c192170cfbab7d2de030010ee0b7d771bd6bca049dd2332874.css integrity="sha256-xe3QiNDJhMGSFwz7q30t4DABDuC313G9a8oEndIzKHQ=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://abiydv.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://abiydv.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://abiydv.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://abiydv.github.io/apple-touch-icon.png><link rel=mask-icon href=https://abiydv.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://abiydv.github.io/posts/aws-eks-okta-auth/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="AWS EKS Okta Auth"><meta property="og:description" content="Authenticate to AWS EKS with Okta"><meta property="og:type" content="article"><meta property="og:url" content="https://abiydv.github.io/posts/aws-eks-okta-auth/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-06-24T00:00:00+00:00"><meta property="article:modified_time" content="2023-06-24T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="AWS EKS Okta Auth"><meta name=twitter:description content="Authenticate to AWS EKS with Okta"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://abiydv.github.io/posts/"},{"@type":"ListItem","position":2,"name":"AWS EKS Okta Auth","item":"https://abiydv.github.io/posts/aws-eks-okta-auth/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"AWS EKS Okta Auth","name":"AWS EKS Okta Auth","description":"Authenticate to AWS EKS with Okta","keywords":["aws","eks","kubernetes","idp","okta"],"articleBody":"Introduction Authenticating to AWS EKS (Elastic Kubernetes Service) using AWS IAM (Identity and Access Management) credentials is a crucial aspect of managing and securing these clusters. However, IAM is not the only option when it comes to authenticating with these clusters. You can also configure additional IDP (identity providers) for this purpose. In this post today, I’ll explain the steps necessary to authenticate with Okta.\nPre-requisities Before diving into the specifics, please ensure you have the following -\nAn Okta app, with it’s corresponding client id/secret. Terraform configs which create the cluster, and have admin level access to configure the cluster. Configuring the EKS OIDC IDP Module Use this module in your Terraform configuration, specifying the required input variables such as cluster name, cluster email, IDP client ID, issuer URL, group claims, username claims, and admin/readonly groups and users. A sample config will look like this -\n1module eks_oidc_idp { 2 source = \"git::ssh://git@github.com/abiydv/aws-eks-okta-auth.git?ref=v1.0.0\" 3 4 cluster_name = \"my-cluster\" 5 cluster_email = \"user\" 6 idp_client_id = \"client-id\" 7 idp_config_name = \"okta\" 8 idp_issuer_url = \"https://example.okta.com\" 9 idp_group_claim = \"groups\" 10 idp_username_claim = \"username\" 11 idp_cluster_admin_groups = [\"okta-admins\"] 12 idp_cluster_admin_users = [\"user1\", \"user2\"] 13 idp_cluster_readonly_groups = [\"okta-devs\"] 14 idp_cluster_readonly_users = [\"user3\", \"user4\"] 15 tags = var.tags 16} Apply the Terraform configuration to provision the OIDC provider for your EKS cluster. This might take upto 20 mins to complete.\nInstalling the Kubelogin Plugin To authenticate with Okta, we need to install the Kubelogin plugin. Follow these steps:\nInstall the Kubelogin plugin using the appropriate package manager for your system. Verify the installation by running the kubectl oidc-login --help command. Configuring the Kubectl User In the ~/.kube/config file, add a new user configuration under the users section, specifying the necessary details such as name, exec command, OIDC issuer URL, client ID, client secret, and additional scopes.\n1- name: okta 2 user: 3 exec: 4 apiVersion: client.authentication.k8s.io/v1beta1 5 args: 6 - oidc-login 7 - get-token 8 - --oidc-issuer-url=https://okta.com/oauth2/ 9 - --oidc-client-id=clientid 10 - --oidc-client-secret=clientsecret 11 - --oidc-extra-scope=profile 12 command: kubectl 13 env: null 14 provideClusterInfo: false Testing Access To test the access to your EKS cluster using Okta authentication, execute any kubectl command. For example, run kubectl get svc to retrieve information about the cluster’s services. If the command executes successfully, it means you have authenticated successfully with Okta as the IDP.\nConclusion In this blog post, we have learned how to authenticate to an AWS EKS cluster using Okta as the IDP. By leveraging Okta’s secure authentication capabilities and the flexibility of AWS EKS, you can ensure robust access control and streamlined management of your Kubernetes clusters. Implementing Okta as the IDP enhances the security and ease of use for developers and administrators working with your EKS infrastructure.\nNote: Code mentioned above is here ","wordCount":"461","inLanguage":"en","datePublished":"2023-06-24T00:00:00Z","dateModified":"2023-06-24T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://abiydv.github.io/posts/aws-eks-okta-auth/"},"publisher":{"@type":"Organization","name":"@abiydv","logo":{"@type":"ImageObject","url":"https://abiydv.github.io/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://abiydv.github.io/ accesskey=h title="@abiydv (Alt + H)">@abiydv</a><div class=logo-switches></div></div><ul id=menu><li><a href=https://abiydv.github.io/ title=Home><span>Home</span></a></li><li><a href=https://abiydv.github.io/about/ title=About><span>About</span></a></li><li><a href=https://abiydv.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://abiydv.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://abiydv.github.io/notes/ title=Notes><span>Notes</span></a></li><li><a href=https://abiydv.github.io/search title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://abiydv.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://abiydv.github.io/posts/>Posts</a></div><h1 class=post-title>AWS EKS Okta Auth</h1><div class=post-description>Authenticate to AWS EKS with Okta</div><div class=post-meta>24.6.23 / Posts / 3 min</div></header><div class=post-content><h2 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h2><p>Authenticating to <a href=https://docs.aws.amazon.com/eks/latest/userguide/cluster-auth.html>AWS EKS (Elastic Kubernetes Service)</a> using AWS IAM (Identity and Access Management) credentials is a crucial aspect of managing and securing these clusters. However, IAM is not the only option when it comes to authenticating with these clusters. You can also configure additional IDP (identity providers) for this purpose. In this post today, I&rsquo;ll explain the steps necessary to authenticate with <a href=https://www.okta.com>Okta</a>.</p><h2 id=pre-requisities>Pre-requisities<a hidden class=anchor aria-hidden=true href=#pre-requisities>#</a></h2><p>Before diving into the specifics, please ensure you have the following -</p><ol><li>An Okta app, with it&rsquo;s corresponding client id/secret.</li><li>Terraform configs which create the cluster, and have admin level access to configure the cluster.</li></ol><h2 id=configuring-the-eks-oidc-idp-module>Configuring the EKS OIDC IDP Module<a hidden class=anchor aria-hidden=true href=#configuring-the-eks-oidc-idp-module>#</a></h2><ol><li><p>Use <a href=https://github.com/abiydv/aws-eks-okta-auth.git>this module</a> in your Terraform configuration, specifying the required input variables such as cluster name, cluster email, IDP client ID, issuer URL, group claims, username claims, and admin/readonly groups and users. A sample config will look like this -</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#66d9ef>module</span> <span style=color:#66d9ef>eks_oidc_idp</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    source <span style=color:#f92672>=</span> &#34;git::ssh://git@github.com/abiydv/aws-eks-okta-auth.git?ref<span style=color:#f92672>=</span><span style=color:#66d9ef>v1</span>.<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>0</span><span style=color:#960050;background-color:#1e0010>&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    cluster_name       <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;my-cluster&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    cluster_email      <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;user&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    idp_client_id      <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;client-id&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>    idp_config_name    <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;okta&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    idp_issuer_url     <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;https://example.okta.com&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    idp_group_claim    <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;groups&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    idp_username_claim <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;username&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>    idp_cluster_admin_groups    <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;okta-admins&#34;</span>]
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    idp_cluster_admin_users     <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;user1&#34;, &#34;user2&#34;</span>]
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>    idp_cluster_readonly_groups <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;okta-devs&#34;</span>]
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>    idp_cluster_readonly_users  <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;user3&#34;, &#34;user4&#34;</span>]
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>    tags <span style=color:#f92672>=</span> <span style=color:#66d9ef>var</span>.<span style=color:#66d9ef>tags</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>}
</span></span></code></pre></div></li><li><p>Apply the Terraform configuration to provision the OIDC provider for your EKS cluster. This might take upto 20 mins to complete.</p></li></ol><h2 id=installing-the-kubelogin-plugin>Installing the Kubelogin Plugin<a hidden class=anchor aria-hidden=true href=#installing-the-kubelogin-plugin>#</a></h2><p>To authenticate with Okta, we need to install the Kubelogin plugin. Follow these steps:</p><ol><li>Install the <a href=https://github.com/int128/kubelogin>Kubelogin plugin</a> using the appropriate package manager for your system.</li><li>Verify the installation by running the <code>kubectl oidc-login --help</code> command.</li></ol><h2 id=configuring-the-kubectl-user>Configuring the Kubectl User<a hidden class=anchor aria-hidden=true href=#configuring-the-kubectl-user>#</a></h2><p>In the <code>~/.kube/config</code> file, add a new user configuration under the users section, specifying the necessary details such as name, exec command, OIDC issuer URL, client ID, client secret, and additional scopes.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>okta</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    <span style=color:#f92672>user</span>:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    <span style=color:#f92672>exec</span>:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>        <span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>client.authentication.k8s.io/v1beta1</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>        <span style=color:#f92672>args</span>:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>        - <span style=color:#ae81ff>oidc-login</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>        - <span style=color:#ae81ff>get-token</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>        - --<span style=color:#ae81ff>oidc-issuer-url=https://okta.com/oauth2/</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>        - --<span style=color:#ae81ff>oidc-client-id=clientid</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>        - --<span style=color:#ae81ff>oidc-client-secret=clientsecret</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>        - --<span style=color:#ae81ff>oidc-extra-scope=profile</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>        <span style=color:#f92672>command</span>: <span style=color:#ae81ff>kubectl</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>        <span style=color:#f92672>env</span>: <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>        <span style=color:#f92672>provideClusterInfo</span>: <span style=color:#66d9ef>false</span>
</span></span></code></pre></div><h2 id=testing-access>Testing Access<a hidden class=anchor aria-hidden=true href=#testing-access>#</a></h2><p>To test the access to your EKS cluster using Okta authentication, execute any kubectl command. For example, run <code>kubectl get svc</code> to retrieve information about the cluster&rsquo;s services. If the command executes successfully, it means you have authenticated successfully with Okta as the IDP.</p><h2 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h2><p>In this blog post, we have learned how to authenticate to an AWS EKS cluster using Okta as the IDP. By leveraging Okta&rsquo;s secure authentication capabilities and the flexibility of AWS EKS, you can ensure robust access control and streamlined management of your Kubernetes clusters. Implementing Okta as the IDP enhances the security and ease of use for developers and administrators working with your EKS infrastructure.</p><b>Note:</b>&nbsp;
Code mentioned above is
<a aria-label="link to https://github.com/abiydv/aws-eks-okta-auth" target=_blank href=https://github.com/abiydv/aws-eks-okta-auth>here&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></div><footer class=post-footer><hr><div class=align-center><div class=slimlist-entry><h2>Tags</h2></div><ul class=post-tags><div class=slimlist-entry><li class=post-tags><a href=https://abiydv.github.io/tags/aws/>aws</a></li><li class=post-tags><a href=https://abiydv.github.io/tags/eks/>eks</a></li><li class=post-tags><a href=https://abiydv.github.io/tags/kubernetes/>kubernetes</a></li><li class=post-tags><a href=https://abiydv.github.io/tags/idp/>idp</a></li><li class=post-tags><a href=https://abiydv.github.io/tags/okta/>okta</a></li></div></ul></div></footer><script src=https://utteranc.es/client.js repo=abiydv/abiydv.github.io issue-term=title label=Comment theme=github-light crossorigin=anonymous async></script><hr><div class=align-left><div class=slimlist-entry><h2>Related</h2></div><ul class=slimlist><li class=slimlist><div class=slimlist-entry><h3 class=slimlist-entry-title><a aria-label="post link to Service Control Policies and BDD" href=https://abiydv.github.io/posts/aws-scp-test-bdd/>Service Control Policies and BDD</a></h3><div class=slimlist-meta>28.6.24 / Posts / 7 min</div></div></li><li class=slimlist><div class=slimlist-entry><h3 class=slimlist-entry-title><a aria-label="post link to Terraform, multi-account and multi-region workloads" href=https://abiydv.github.io/posts/terraform-multiaccount-multiregion/>Terraform, multi-account and multi-region workloads</a></h3><div class=slimlist-meta>25.5.22 / Posts / 5 min</div></div></li><li class=slimlist><div class=slimlist-entry><h3 class=slimlist-entry-title><a aria-label="post link to Terraform, Bitbucket pipelines and OIDC" href=https://abiydv.github.io/posts/terraform-bitbucket-pipeline-oidc/>Terraform, Bitbucket pipelines and OIDC</a></h3><div class=slimlist-meta>30.9.21 / Posts / 7 min</div></div></li></ul></div></article></main><footer class=footer><span>&copy; 2019-2025 <a href=https://abiydv.github.io/>@abiydv</a> / </span><span>Published 4.4.25 /
</span><span>Thanks <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a>, <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script></body></html>